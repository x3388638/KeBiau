(this["webpackJsonpke-biau"]=this["webpackJsonpke-biau"]||[]).push([[0],{102:function(e,t,a){},103:function(e,t,a){},104:function(e,t,a){},105:function(e,t,a){"use strict";a.r(t);var n=a(1),r=a.n(n),i=a(20),l=a.n(i),o=a(18),c=(a(69),a(9)),s=a(10),u=a(12),d=a(11),m=a(5),h=a(2),p=a(0),f=a.n(p),b=a(6),g=a(4);function v(){var e=Object(m.a)(["\n\t@media (max-width: 1000px) and (min-width: 576px) {\n\t\tdisplay: none;\n\t}\n"]);return v=function(){return e},e}function E(){var e=Object(m.a)(["\n\tborder-radius: 50px;\n"]);return E=function(){return e},e}function C(){var e=Object(m.a)(["\n\t@media (max-width: 850px) and (min-width: 576px) {\n\t\tdisplay: none;\n\t}\n"]);return C=function(){return e},e}function k(){var e=Object(m.a)(["\n\tz-index: 5;\n\tpadding: 0.3rem 1rem;\n"]);return k=function(){return e},e}var O=Object(b.b)(h.z)(k()),y=b.b.span(C()),x=b.b.img(E()),w=b.b.span(v()),j=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).toggleNavbar=n.toggleNavbar.bind(Object(g.a)(n)),n.toggleLoginTooltip=n.toggleLoginTooltip.bind(Object(g.a)(n)),n.toggleLogoutTooltip=n.toggleLogoutTooltip.bind(Object(g.a)(n)),n.state={navbarIsOpen:!1,loginTooltip:!1,logoutTooltip:!1},n}return Object(s.a)(a,[{key:"toggleNavbar",value:function(){this.setState((function(e){return{navbarIsOpen:!e.navbarIsOpen}}))}},{key:"toggleLoginTooltip",value:function(){this.setState((function(e){return{loginTooltip:!e.loginTooltip}}))}},{key:"toggleLogoutTooltip",value:function(){this.setState((function(e){return{logoutTooltip:!e.logoutTooltip}}))}},{key:"handleLogin",value:function(){var e=new window.firebase.auth.FacebookAuthProvider;window.firebase.auth().signInWithPopup(e).then((function(e){var t=e.credential.accessToken,a=e.user.providerData[0].uid;fetch("https://graph.facebook.com/v2.10/".concat(a,"?fields=link&access_token=").concat(t)).then((function(e){return e.json()})).then((function(){return window.location.reload()}))})).catch((function(e){var t=e.code,a=e.message;console.error("[".concat(t,"] ").concat(a))}))}},{key:"handleLogout",value:function(){window.firebase.auth().signOut().then((function(){window.location.reload()})).catch((function(e){console.error(e)}))}},{key:"render",value:function(){var e=this.context.router.route,t=this.context.user,a=!!t,n=a&&!!t.uid;return r.a.createElement(O,{color:"dark",dark:!0,expand:"sm"},r.a.createElement(h.A,{href:"https://2yc.tw/KeBiau"},r.a.createElement("img",{src:"".concat("https://2yc.tw/KeBiau","/logo.png"),alt:"",height:"31px"})," \u81ea\u5df1\u7684\u8ab2\u8868\u81ea\u5df1\u6392 2.0"),r.a.createElement(h.B,{onClick:this.toggleNavbar}),r.a.createElement(h.j,{isOpen:this.state.navbarIsOpen,navbar:!0},r.a.createElement(h.w,{navbar:!0},r.a.createElement(h.x,null,r.a.createElement(o.b,{className:"/"===e.match.path?"active nav-link":" nav-link",to:"/"},r.a.createElement("i",{className:"fa fa-table","aria-hidden":"true"})," ",r.a.createElement("span",{className:"d-sm-none d-md-inline"},r.a.createElement(y,null,"\u6211\u7684"),"\u8ab2\u8868"))),r.a.createElement(h.x,null,r.a.createElement(o.b,{className:"/exchange"===e.match.path?"active nav-link":" nav-link",to:"/exchange"},r.a.createElement("i",{className:"fa fa-exchange","aria-hidden":"true"})," ",r.a.createElement("span",{className:"d-sm-none d-md-inline"},"\u63db\u8ab2",r.a.createElement(y,null,"\u5e73\u53f0")))),r.a.createElement(h.x,null,r.a.createElement(o.b,{className:"/review"===e.match.path?"active nav-link":" nav-link",to:"/review"},r.a.createElement("i",{className:"fa fa-thumbs-up","aria-hidden":"true"})," ",r.a.createElement("span",{className:"d-sm-none d-md-inline"},r.a.createElement(y,null,"\u8ab2\u7a0b"),"\u8a55\u50f9"))),r.a.createElement(h.x,null,r.a.createElement(h.y,{href:"https://fb.com/MOLi.rocks/posts/2104134533131853",target:"_blank"},r.a.createElement("span",null,r.a.createElement("i",{className:"fa fa-question-circle","aria-hidden":"true"})," ",r.a.createElement("span",{className:"d-sm-none d-md-inline"},"\u9078\u8ab2\u6559\u5b78")))),r.a.createElement(h.x,null,r.a.createElement(h.y,{href:"https://github.com/x3388638/KeBiau/issues",target:"_blank"},r.a.createElement("span",null,r.a.createElement("i",{className:"fa fa-exclamation-circle","aria-hidden":"true"})," ",r.a.createElement("span",{className:"d-sm-none d-md-inline"},"\u56de\u5831"))))),r.a.createElement(h.w,{className:"ml-auto",navbar:!0},a&&n&&r.a.createElement(h.x,null,r.a.createElement(h.y,{href:t.fbLink||"https://fb.com/".concat(t.uid),target:"_blank"},r.a.createElement(x,{src:"https://graph.facebook.com/".concat(t.uid,"/picture"),alt:"",height:"21"}),r.a.createElement(w,{className:"ml-2"},t.displayName))),a&&r.a.createElement(h.x,null,n&&r.a.createElement(h.y,{id:"LogoutBtn",href:"#",onClick:this.handleLogout},r.a.createElement("i",{className:"fa fa-sign-out","aria-hidden":"true"})," ",r.a.createElement("span",{className:"d-inline d-sm-none"},"\u767b\u51fa"),r.a.createElement(h.E,{delay:{show:0,hide:0},placement:"left",isOpen:this.state.logoutTooltip,target:"LogoutBtn",toggle:this.toggleLogoutTooltip},"\u767b\u51fa")),n||r.a.createElement(h.y,{id:"LoginBtn",href:"#",onClick:this.handleLogin},r.a.createElement("i",{className:"fa fa-facebook-square","aria-hidden":"true"}),r.a.createElement(h.E,{delay:{show:0,hide:0},placement:"left",isOpen:this.state.loginTooltip,target:"LoginBtn",toggle:this.toggleLoginTooltip},"\u767b\u5165 Facebook"))))))}}]),a}(r.a.Component);j.contextTypes={user:f.a.object,router:f.a.object};a(75);function T(){var e=Object(m.a)(["\n\tposition: relative;\n"]);return T=function(){return e},e}var _=Object(b.b)(h.k)(T()),N=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).state={user:null},n.db=window.firebase.database(),window.firebase.auth().onAuthStateChanged((function(e){e?n.setState({user:Object.assign({},e.providerData[0],{uuid:e.uid})}):n.setState({user:{uid:null}})})),n}return Object(s.a)(a,[{key:"getChildContext",value:function(){return{user:this.state.user}}},{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement(j,null),r.a.createElement(_,null,this.props.children))}}]),a}(r.a.Component);N.childContextTypes={user:f.a.object};var S=a(21),L=a(13),M=a.n(L),D=a(57);function R(){var e=Object(m.a)(["\n\tdisplay: flex;\n\tjustify-content: center;\n\tmargin-top: ",";\n"]);return R=function(){return e},e}var F=b.b.div(R(),(function(e){return"".concat(e.marginTop||20,"px")})),B=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(s.a)(a,[{key:"render",value:function(){return r.a.createElement(F,this.props,r.a.createElement(D.BarLoader,{color:"#666",loading:!0,height:5,width:200}))}}]),a}(r.a.PureComponent);function A(){var e=Object(m.a)(['\n\tbackground: #f9f9f9;\n\tborder-radius: 2px;\n\t& span {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tpadding: 5px;\n\t\t&.TableRow__link,\n\t\t&.TableRow__btn {\n\t\t\tjustify-content: center;\n\t\t}\n\t}\n\n\t@media screen and (max-width: 991px) {\n\t\tpadding: 5px;\n\t\tbox-shadow: 1px 1px 2px 0px #878787;\n\t\tmargin-bottom: 10px;\n\t\tgrid-template-columns: 1fr 3fr 1fr;\n\t\tgrid-template-rows: 1fr 1fr 1fr 1fr;\n\t\tgrid-template-areas: "cid cname classes"\n\t\t\t"teacher teacher teacher"\n\t\t\t"time time time"\n\t\t\t"location location location"\n\t\t\t"link link btn";\n\t\t& span {\n\t\t\tpadding: 0 8px;\n\t\t}\n\n\t\t& span.TableRow__cid {\n\t\t\tgrid-area: cid;\n\t\t}\n\t\t& span.TableRow__cname {\n\t\t\tgrid-area: cname;\n\t\t\tjustify-content: center;\n\t\t\tfont-weight: bold;\n\t\t}\n\t\t& span.TableRow__classes {\n\t\t\tgrid-area: classes;\n\t\t\tjustify-content: flex-end;\n\t\t\t&::after {\n\t\t\t\tcontent: \'\u73ed\';\n\t\t\t\tpadding-left: 2px;\n\t\t\t}\n\t\t}\n\t\t& span.TableRow__time {\n\t\t\tgrid-area: time;\n\t\t\t&::before {\n\t\t\t\tcontent: \'\u6642\u9593:\';\n\t\t\t\tpadding-right: 2px;\n\t\t\t}\n\t\t}\n\t\t& span.TableRow__location {\n\t\t\tgrid-area: location;\n\t\t\t&::before {\n\t\t\t\tcontent: \'\u5730\u9ede:\';\n\t\t\t\tpadding-right: 2px;\n\t\t\t}\n\t\t}\n\t\t& span.TableRow__teacher {\n\t\t\tgrid-area: teacher;\n\t\t\t&::before {\n\t\t\t\tcontent: \'\u6559\u5e2b:\';\n\t\t\t\tpadding-right: 2px;\n\t\t\t}\n\t\t}\n\t\t& span.TableRow__grade {\n\t\t\tdisplay: none;\n\t\t}\n\t\t& span.TableRow__link {\n\t\t\tgrid-area: link;\n\t\t\tjustify-content: flex-end;\n\t\t}\n\t\t& span.TableRow__btn {\n\t\t\tgrid-area: btn;\n\t\t\t& button {\n\t\t\t\twidth: 100%;\n\t\t\t}\n\t\t}\n\t}\n']);return A=function(){return e},e}function z(){var e=Object(m.a)(["\n\tmargin: 0 5px 5px;\n\tposition: sticky;\n    top: 0;\n    left: 0;\n    background: #fff;\n    z-index: 10;\n    border-bottom: 1px solid #adadad;\n\t& span {\n\t\tpadding: 10px 0px;\n\t\tfont-weight: bold;\n\t}\n\n\t@media screen and (max-width: 992px) {\n\t\tdisplay: none;\n\t}\n"]);return z=function(){return e},e}function I(){var e=Object(m.a)(["\n\tdisplay: grid;\n\tgrid-template-columns: 2fr 3fr 1fr 1fr 2fr 3fr 1fr 1fr 1fr;\n\tgrid-gap: 2px;\n\tmargin: 5px;\n"]);return I=function(){return e},e}var U=b.b.div(I()),q=Object(b.b)(U)(z()),W=Object(b.b)(U)(A()),J=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).state={selected:""},n.handleSelect=n.handleSelect.bind(Object(g.a)(n)),n}return Object(s.a)(a,[{key:"componentDidMount",value:function(){this.setState({selected:"\u901a\u8b58"})}},{key:"handleSelect",value:function(e){this.setState({selected:e.target.value}),this.props.onChangeDept(e.target.value)}},{key:"render",value:function(){return r.a.createElement("div",{className:"mb-2"},r.a.createElement("strong",null,"\u958b\u8ab2\u55ae\u4f4d\uff1a"),r.a.createElement("select",{value:this.state.selected,onChange:this.handleSelect},Object.keys(this.props.deptList).map((function(e,t){return r.a.createElement("option",{key:t,value:e},e)})))," "," ",r.a.createElement(h.c,{className:this.props.filterCourse?"active":"",color:this.props.filterCourse?"danger":"light",size:"sm",onClick:this.props.onFilterCourse},"\u7be9\u9078\u8ab2\u7a0b")," "," ",r.a.createElement(h.c,{className:this.props.filterConflict?"active":"",color:this.props.filterConflict?"danger":"light",size:"sm",onClick:this.props.onFilterConflict},this.props.filterConflict?"\u53d6\u6d88\u904e\u6ffe":"\u904e\u6ffe\u885d\u5802"),r.a.createElement("a",{className:"float-right mr-2 text-warning",href:"https://ccweb.ncnu.edu.tw/student/DeptQuerylist.php",target:"_blank",rel:"noopener noreferrer"},r.a.createElement("i",{className:"fa fa-sitemap","aria-hidden":"true"})," \u5404\u7cfb\u6240\u8ab2\u7a0b\u5730\u5716"))}}]),a}(r.a.Component),H=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(s.a)(a,[{key:"render",value:function(){var e=this,t=this.props.courseList;return r.a.createElement("div",null,r.a.createElement(J,this.props),r.a.createElement("div",{style:{overflow:"auto",maxHeight:"487px",background:"#fff",width:"100%"}},!t.length&&r.a.createElement(B,null),!!t.length&&r.a.createElement(r.a.Fragment,null,r.a.createElement(q,null,r.a.createElement("span",null,"\u8ab2\u865f"),r.a.createElement("span",null,"\u8ab2\u7a0b\u540d\u7a31"),r.a.createElement("span",null,"\u73ed\u5225"),r.a.createElement("span",null,"\u6642\u6bb5"),r.a.createElement("span",null,"\u6388\u8ab2\u5730\u9ede"),r.a.createElement("span",null,"\u6559\u5e2b"),r.a.createElement("span",null,"\u5e74\u7d1a"),r.a.createElement("span",null),r.a.createElement("span",null)),Object.keys(t).map((function(a){return e.props.filterConflict&&t[a].isConflict?null:r.a.createElement(W,{key:a,"data-uuid":a},r.a.createElement("span",{className:"TableRow__cid"},t[a].cid),r.a.createElement("span",{className:"TableRow__cname"},t[a].cname),r.a.createElement("span",{className:"TableRow__classes"},t[a].classes),r.a.createElement("span",{className:"TableRow__time"},t[a].time),r.a.createElement("span",{className:"TableRow__location"},t[a].location),r.a.createElement("span",{className:"TableRow__teacher"},t[a].teacher),r.a.createElement("span",{className:"TableRow__grade"},t[a].grade),r.a.createElement("span",{className:"TableRow__link"},r.a.createElement("a",{href:"https://ccweb.ncnu.edu.tw/student/aspmaker_course_opened_detail_viewview.php?showdetail=&year=".concat(t[a].year,"&courseid=").concat(t[a].cid,"&_class=").concat(t[a].classes,"&modal=0"),target:"_blank"},"\u8ab2\u7db1 ",r.a.createElement("i",{className:"fa fa-external-link","aria-hidden":"true"}))),r.a.createElement("span",{className:"TableRow__btn"},r.a.createElement(h.c,{color:"success",size:"sm",disabled:!!t[a].isConflict,onClick:function(){e.props.onAddCourse(t[a],!0)}},t[a].isConflict?"\u885d\u5802":"\u52a0\u5165")))})))))}}]),a}(r.a.Component);function P(){var e=Object(m.a)(["\n\tvertical-align: middle !important;\n\tbackground: ",";\n\tcolor: ",";\n\t&:hover {\n\t\tbackground: #fafafa;\n\t\t"," {\n\t\t\tdisplay: initial;\n\t\t}\n\n\t\t"," {\n\t\t\tdisplay: initial;\n\t\t}\n\t}\n"]);return P=function(){return e},e}function K(){var e=Object(m.a)(["\n\tdisplay: none;\n\tcursor: pointer;\n\tfont-size: 14px;\n\t&:hover {\n\t\tcolor: #0275d8;\n\t}\n"]);return K=function(){return e},e}function Y(){var e=Object(m.a)(["\n\tdisplay: none;\n\tcursor: pointer;\n\tcolor: #c9302c !important;\n\tfont-size: 20px;\n"]);return Y=function(){return e},e}function G(){var e=Object(m.a)(["\n\ttop: -8px;\n\tposition: relative;\n"]);return G=function(){return e},e}var V=b.b.span(G()),Z=b.b.span(Y()),$=b.b.i(K()),X=b.b.td(P(),(function(e){return"".concat(e.bg," !important")||!1}),(function(e){if(e.bg){var t=function(e){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null}(e.bg),a=t.r,n=t.g,r=t.b;return Math.sqrt(a*a*.241+n*n*.691+r*r*.068)<125?"#fff":""}return""}),Z,$);var Q=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).state={mouseEnter:!1},n.handleMouseEnter=n.handleMouseEnter.bind(Object(g.a)(n)),n.handleMouseLeave=n.handleMouseLeave.bind(Object(g.a)(n)),n.handleDel=n.handleDel.bind(Object(g.a)(n)),n.handleEdit=n.handleEdit.bind(Object(g.a)(n)),n}return Object(s.a)(a,[{key:"handleMouseEnter",value:function(){this.setState({mouseEnter:!0})}},{key:"handleMouseLeave",value:function(){this.setState({mouseEnter:!1})}},{key:"handleDel",value:function(e){if(!this.props.shared){var t=e.target.parentNode.parentNode.parentNode.getAttribute("data-time"),a=e.target.parentNode.parentNode.getAttribute("rowspan");this.props.onDelCourse(t,a,this.props.dayOfWeek)}}},{key:"handleEdit",value:function(e){this.props.shared||this.props.onEditCourse({time:e.target.parentNode.parentNode.parentNode.parentNode.getAttribute("data-time"),dayOfWeek:this.props.dayOfWeek,title:this.props.title,desc:this.props.desc,bg:this.props.bg})}},{key:"hexToRgb",value:function(e){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null}},{key:"render",value:function(){return r.a.createElement(X,{bg:this.props.bg,rowSpan:this.props.rowspan||1,onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave},!this.props.shared&&this.props.title&&this.state.mouseEnter&&r.a.createElement("span",{className:"float-right mr-2"},r.a.createElement(Z,{className:"text-danger",onClick:this.handleDel},"\xd7"),r.a.createElement("br",null),r.a.createElement(V,null,r.a.createElement($,{className:"fa fa-pencil","aria-hidden":"true",onClick:this.handleEdit}))),this.props.title&&this.props.title,r.a.createElement("br",{className:"uniBR"}),this.props.desc&&this.props.desc)}}]),a}(r.a.Component);function ee(){var e=Object(m.a)(["\n\twidth: auto;\n\t&:hover {\n\t\t"," {\n\t\t\tdisplay: initial\n\t\t}\n\t}\n"]);return ee=function(){return e},e}function te(){var e=Object(m.a)(["\n\tdisplay: none;\n\t&:hover {\n\t\tcursor: pointer;\n\t\tcolor: #c9302c !important;\n\t}\n"]);return te=function(){return e},e}var ae=b.b.i(te()),ne=b.b.th(ee(),ae),re=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(s.a)(a,[{key:"componentDidUpdate",value:function(){var e=document.getElementById("CustomTable").className.replace("table-bordered","").trim().split(" ");document.getElementById("CustomTable").className=e.join(" "),setTimeout((function(){document.getElementById("CustomTable").className+=" table-bordered"}),1)}},{key:"render",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement(h.D,{id:"CustomTable",bordered:!0,responsive:!0,size:"sm",style:{background:"#fff",tableLayout:"fixed"}},r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",{style:{width:"60px"}}),r.a.createElement("th",{className:"text-center"},"\u661f\u671f\u4e00"),r.a.createElement("th",{className:"text-center"},"\u661f\u671f\u4e8c"),r.a.createElement("th",{className:"text-center"},"\u661f\u671f\u4e09"),r.a.createElement("th",{className:"text-center"},"\u661f\u671f\u56db"),r.a.createElement("th",{className:"text-center"},"\u661f\u671f\u4e94"),this.props.tableData.sat&&r.a.createElement(ne,{className:"text-center"},"\u661f\u671f\u516d"," ",r.a.createElement(ae,{className:"fa fa-times-circle text-danger","aria-hidden":"true",onClick:function(){!e.props.shared&&e.props.onDelSatOrSun("sat")}})),this.props.tableData.sun&&r.a.createElement(ne,{className:"text-center"},"\u661f\u671f\u65e5"," ",r.a.createElement(ae,{className:"fa fa-times-circle text-danger","aria-hidden":"true",onClick:function(){!e.props.shared&&e.props.onDelSatOrSun("sun")}})))),r.a.createElement("tbody",null,["a/08","b/09","c/10","d/11","z/12","e/13","f/14","g/15","h/16","i/17","j/18","k/19","l/20","m/21"].map((function(t,a){return r.a.createElement("tr",{"data-time":t,key:a},r.a.createElement("th",{className:"text-center"},t),Object.keys(e.props.tableData.course[t]).map((function(a,n){var i=e.props.tableData.course[t][a];return null===i?null:(e.props.tableData.sat||"5"!==a)&&(e.props.tableData.sun||"6"!==a)?r.a.createElement(Q,Object.assign({},i,{key:n,dayOfWeek:a,shared:e.props.shared,onDelCourse:e.props.onDelCourse,onEditCourse:e.props.onEditCourse})):null})))})))))}}]),a}(r.a.Component),ie=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).state={exportDropdownOpen:!1,clearDropdownOpen:!1},n.toggleExportDropdown=n.toggleExportDropdown.bind(Object(g.a)(n)),n.toggleClearDropdown=n.toggleClearDropdown.bind(Object(g.a)(n)),n}return Object(s.a)(a,[{key:"toggleExportDropdown",value:function(){this.setState((function(e){return{exportDropdownOpen:!e.exportDropdownOpen}}))}},{key:"toggleClearDropdown",value:function(){this.setState((function(e){return{clearDropdownOpen:!e.clearDropdownOpen}}))}},{key:"handleExportExcel",value:function(e){document.querySelectorAll(".uniBR").forEach((function(e){e.setAttribute("style","mso-data-placement:same-cell")}));var t='<html><head><meta charset="utf-8"></head><body>'+document.getElementById("CustomTable").parentNode.innerHTML+"</body></html>";window.open("data:application/vnd.ms-excel,"+encodeURIComponent(t)),e.preventDefault()}},{key:"handleExportPNG",value:function(){window.html2canvas(document.querySelectorAll("#CustomTable"),{onrendered:function(e){}}),window.html2canvas(document.querySelectorAll("#CustomTable"),{onrendered:function(e){window.Canvas2Image.saveAsPNG(e)}})}},{key:"render",value:function(){var e={cursor:"pointer",marginBottom:"5px"};return r.a.createElement("div",null,r.a.createElement(h.c,{color:"primary",size:"sm",className:"mr-1",style:e,onClick:this.props.onSave},r.a.createElement("i",{className:"fa fa-floppy-o","aria-hidden":"true"})," ",r.a.createElement("span",{className:"d-none d-sm-inline"},"\u5132\u5b58")),r.a.createElement(h.c,{color:"light",size:"sm",className:"mr-1",style:e,onClick:this.props.onShare},r.a.createElement("i",{className:"fa fa-share-square-o","aria-hidden":"true"})," ",r.a.createElement("span",{className:"d-none d-sm-inline"},"\u5206\u4eab")),r.a.createElement(h.d,{className:"mr-1",isOpen:this.state.exportDropdownOpen,style:e,size:"sm",toggle:this.toggleExportDropdown},r.a.createElement(h.n,{caret:!0,color:"light"},r.a.createElement("i",{className:"fa fa-download","aria-hidden":"true"})," ",r.a.createElement("span",{className:"d-none d-sm-inline"},"\u532f\u51fa")),r.a.createElement(h.m,null,r.a.createElement(h.l,{onClick:this.handleExportExcel},r.a.createElement("i",{className:"fa fa-file-excel-o","aria-hidden":"true"})," .xls"),r.a.createElement(h.l,{onClick:this.handleExportPNG},r.a.createElement("i",{className:"fa fa-file-image-o","aria-hidden":"true"})," .png"))),r.a.createElement("span",{className:"ml-2 mr-2"}),r.a.createElement(h.d,{className:"mr-1",isOpen:this.state.clearDropdownOpen,style:e,size:"sm",toggle:this.toggleClearDropdown},r.a.createElement(h.n,{caret:!0,color:"light"},r.a.createElement("i",{className:"fa fa-repeat","aria-hidden":"true"})," ",r.a.createElement("span",{className:"d-none d-sm-inline"},"\u6e05\u9664")),r.a.createElement(h.m,null,r.a.createElement(h.l,{onClick:this.props.onReColor},r.a.createElement("i",{className:"fa fa-magic","aria-hidden":"true"})," \u6a19\u8a18"),r.a.createElement(h.l,{onClick:this.props.onReTable},r.a.createElement("i",{className:"fa fa-table","aria-hidden":"true"})," \u8ab2\u8868"))),r.a.createElement(h.c,{color:"light",size:"sm",className:"mr-1",style:e,onClick:this.props.onClickCustom},r.a.createElement("i",{className:"fa fa-plus","aria-hidden":"true"})," ",r.a.createElement("span",{className:"d-none d-sm-inline"},"\u81ea\u8a02\u6642\u6bb5")))}}]),a}(r.a.Component),le=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).state={deptList:{},courseList:{},customTable:{course:{"a/08":{0:{},1:{},2:{},3:{},4:{},5:{},6:{}},"b/09":{0:{},1:{},2:{},3:{},4:{},5:{},6:{}},"c/10":{0:{},1:{},2:{},3:{},4:{},5:{},6:{}},"d/11":{0:{},1:{},2:{},3:{},4:{},5:{},6:{}},"z/12":{0:{},1:{},2:{},3:{},4:{},5:{},6:{}},"e/13":{0:{},1:{},2:{},3:{},4:{},5:{},6:{}},"f/14":{0:{},1:{},2:{},3:{},4:{},5:{},6:{}},"g/15":{0:{},1:{},2:{},3:{},4:{},5:{},6:{}},"h/16":{0:{},1:{},2:{},3:{},4:{},5:{},6:{}},"i/17":{0:{},1:{},2:{},3:{},4:{},5:{},6:{}},"j/18":{0:{},1:{},2:{},3:{},4:{},5:{},6:{}},"k/19":{0:{},1:{},2:{},3:{},4:{},5:{},6:{}},"l/20":{0:{},1:{},2:{},3:{},4:{},5:{},6:{}},"m/21":{0:{},1:{},2:{},3:{},4:{},5:{},6:{}}},sat:!1,sun:!1},modalEditCourse:{open:!1,modalTitle:"\u7de8\u8f2f\u8ab2\u7a0b",title:"",desc:"",bg:""},modalCustomCourseOpen:!1,filterConflict:!1,modalFilterCourseOpen:!1,filterCourseForm:{cname:"",teacher:"",time:"",location:""}},n.timeMap={a:"a/08",b:"b/09",c:"c/10",d:"d/11",z:"z/12",e:"e/13",f:"f/14",g:"g/15",h:"h/16",i:"i/17",j:"j/18",k:"k/19",l:"l/20",m:"m/21"},n.timeOrder=["a","b","c","d","z","e","f","g","h","i","j","k","l","m"],n.db=window.firebase.database(),n.getCourseList=n.getCourseList.bind(Object(g.a)(n)),n.getCourseData=n.getCourseData.bind(Object(g.a)(n)),n.changeDept=n.changeDept.bind(Object(g.a)(n)),n.getTableData=n.getTableData.bind(Object(g.a)(n)),n.checkConflict=n.checkConflict.bind(Object(g.a)(n)),n.handleDelSatOrSun=n.handleDelSatOrSun.bind(Object(g.a)(n)),n.handleDelCourse=n.handleDelCourse.bind(Object(g.a)(n)),n.handleOpenEditModal=n.handleOpenEditModal.bind(Object(g.a)(n)),n.toggleModalEditCourse=n.toggleModalEditCourse.bind(Object(g.a)(n)),n.handleEditCourse=n.handleEditCourse.bind(Object(g.a)(n)),n.handleReColor=n.handleReColor.bind(Object(g.a)(n)),n.handleReTable=n.handleReTable.bind(Object(g.a)(n)),n.toggleModalCustomCourse=n.toggleModalCustomCourse.bind(Object(g.a)(n)),n.handleAddCustomCourse=n.handleAddCustomCourse.bind(Object(g.a)(n)),n.handleSave=n.handleSave.bind(Object(g.a)(n)),n.handleShare=n.handleShare.bind(Object(g.a)(n)),n.filterConflict=n.filterConflict.bind(Object(g.a)(n)),n.toggleModalFilterCourse=n.toggleModalFilterCourse.bind(Object(g.a)(n)),n.handleFilterCourse=n.handleFilterCourse.bind(Object(g.a)(n)),n.handleClearFilterCourse=n.handleClearFilterCourse.bind(Object(g.a)(n)),n.handleFilterCourseChange=n.handleFilterCourseChange.bind(Object(g.a)(n)),n}return Object(s.a)(a,[{key:"componentDidMount",value:function(){this.getCourseData(),this.getTableData()}},{key:"getCourseList",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"\u901a\u8b58",a=window.sessionStorage.courseList?JSON.parse(window.sessionStorage.courseList):"{}";this.db.ref("course/".concat(t)).once("value").then((function(n){e.setState({courseList:n.val()||{}}),window.sessionStorage.courseList=JSON.stringify(Object.assign({},a,Object(S.a)({},t,n.val())))}))}},{key:"getCourseData",value:function(){var e=this;this.db.ref("deptList/").once("value").then((function(t){window.sessionStorage.deptList=JSON.stringify(t.val()||{}),e.setState({deptList:t.val()||{}})})),this.getCourseList()}},{key:"changeDept",value:function(e){this.getCourseList(e)}},{key:"getTableData",value:function(){var e=this,t=this.context.user;null!==t?t.uid&&this.db.ref("customTable/".concat(t.uuid)).once("value").then((function(t){var a=t.val();a&&e.setState({customTable:Object.assign({},JSON.parse(a))})})):setTimeout(this.getTableData,100)}},{key:"checkConflict",value:function(e,t){var a=this,n=e.time.toLowerCase(),r=this.apartCourseTime(n),i=!0;if(r.some((function(e){var n=a.validateTime(e);return!n.valid&&(t&&alert(n.msg),i=!1,!0)})),i){var l=!1,o=M()(this.state.customTable);return r.forEach((function(n,r){if(!l){var i=n,c=i[0],s=i[1],u=i.length-1;if(null===o.course[a.timeMap[s]][c-1]||o.course[a.timeMap[s]][c-1].title)l=!0;else{t&&(o.course[a.timeMap[s]][c-1]={rowspan:u,title:e.cname||e.title,desc:e.desc||"".concat(e.location," ").concat(e.teacher),bg:e.bg||""});for(var d=a.timeOrder.indexOf(s)+1,m=a.timeMap[a.timeOrder[d]],h=0;h<u-1;h++){var p=o.course[m][c-1];if(null===p||p.title)return void(l=!0);t&&(o.course[m][c-1]=null),d++,m=a.timeMap[a.timeOrder[d]]}t&&("6"!==c||o.sat||(o.sat=!0),"7"!==c||o.sun||(o.sun=!0))}}})),l&&t?void alert("!!! \u885d\u5802 !!!"):(t&&this.setState({customTable:M()(o)}),l)}return!1}},{key:"validateTime",value:function(e){if(/^[1-7]{1}[A-MZa-mz]+$/.test(e)){for(var t=-1,a=0,n=1;n<e.length;n++){var r=e[n].charCodeAt();if(-1!==t){if(122===r){if(100!==t){a++;break}t=r;continue}if(101===r){if(122!==t){a++;break}t=r;continue}if(r!==+t+1){a++;break}}t=r}return a?{valid:!1,msg:"\u6642\u6bb5\u4e0d\u9023\u7e8c"}:{valid:!0}}return{valid:!1,msg:"\u6642\u9593\u683c\u5f0f\u932f\u8aa4"}}},{key:"apartCourseTime",value:function(e){var t=[];return""===e?["zzzzz"]:e.replace(/[1-7]{1}[A-MZa-mz]+/g,"").length>0?(t.push(e),t):e.match(/[1-7]{1}[A-MZa-mz]+/g)}},{key:"handleDelSatOrSun",value:function(e){var t=M()(this.state.customTable);t[e]=!1;var a="sat"===e?5:6;Object.keys(t.course).forEach((function(e,n){t.course[e][a]={}})),this.setState({customTable:M()(t)})}},{key:"handleDelCourse",value:function(e,t,a){var n=M()(this.state.customTable);n.course[e][a]={};for(var r=this.timeOrder.indexOf(e[0])+1,i=this.timeMap[this.timeOrder[r]],l=0;l<t-1;l++)n.course[i][a]={},r++,i=this.timeMap[this.timeOrder[r]];this.setState({customTable:M()(n)})}},{key:"handleOpenEditModal",value:function(e){var t=M()(this.state.modalEditCourse);t.open=!0,t.modalTitle="\u7de8\u8f2f ".concat(e.title),t.title=e.title,t.desc=e.desc,t.bg=e.bg,t.time=e.time,t.dayOfWeek=e.dayOfWeek,this.setState({modalEditCourse:M()(t)})}},{key:"toggleModalEditCourse",value:function(){var e=M()(this.state.modalEditCourse);e.open=!e.open,this.setState({modalEditCourse:M()(e)})}},{key:"handleEditCourse",value:function(e,t){if(""!==document.getElementById("ModalEditCourse__inputTitle").value){var a=M()(this.state.modalEditCourse);a.open=!1;var n=M()(this.state.customTable);n.course[e][t].title=document.getElementById("ModalEditCourse__inputTitle").value,n.course[e][t].desc=document.getElementById("ModalEditCourse__inputDesc").value,n.course[e][t].bg=document.getElementById("ModalEditCourse__inputBg").value,this.setState({modalEditCourse:M()(a),customTable:M()(n)})}else alert("\u6a19\u984c\u4e0d\u5f97\u70ba\u7a7a")}},{key:"handleReColor",value:function(){var e=M()(this.state.customTable);Object.keys(e.course).forEach((function(t){Object.keys(e.course[t]).forEach((function(a){e.course[t][a]&&(e.course[t][a].bg="")}))})),this.setState({customTable:M()(e)})}},{key:"handleReTable",value:function(){var e=M()(this.state.customTable);Object.keys(e.course).forEach((function(t){Object.keys(e.course[t]).forEach((function(a){e.course[t][a]={}}))})),e.sat=!1,e.sun=!1,this.setState({customTable:M()(e)})}},{key:"toggleModalCustomCourse",value:function(){this.setState((function(e){return{modalCustomCourseOpen:!e.modalCustomCourseOpen}}))}},{key:"handleAddCustomCourse",value:function(){var e=document.getElementById("ModalCustomCourse__inputTime").value,t=document.getElementById("ModalCustomCourse__inputTitle").value;e&&t?(this.checkConflict({time:e,title:t,desc:document.getElementById("ModalCustomCourse__inputDesc").value||" ",bg:document.getElementById("ModalCustomCourse__inputBg").value},!0),this.toggleModalCustomCourse()):alert("\u6642\u9593\u3001\u6a19\u984c\u4e0d\u5f97\u70ba\u7a7a")}},{key:"handleSave",value:function(){this.db.ref("customTable/".concat(this.context.user.uuid)).set(JSON.stringify(this.state.customTable)).then((function(){alert("\u5132\u5b58\u6210\u529f!")}))}},{key:"handleShare",value:function(){var e=this.context.user.uuid,t=(Date.now()*Math.random()*Math.random()).toString(16).replace(".","").substring(2,6);this.db.ref("sharedTable/".concat(e)).set(JSON.stringify(Object(S.a)({},t,this.state.customTable))).then((function(){prompt("\u5df2\u5c07\u7576\u524d\u8ab2\u8868\u5206\u4eab\u65bc\u4ee5\u4e0b\u9023\u7d50","".concat("https://2yc.tw/KeBiau","/#/share/").concat(e).concat(t))}))}},{key:"filterConflict",value:function(){this.setState((function(e){return{filterConflict:!e.filterConflict}}))}},{key:"toggleModalFilterCourse",value:function(){this.setState((function(e){return{modalFilterCourseOpen:!e.modalFilterCourseOpen}}))}},{key:"handleFilterCourseChange",value:function(e,t){var a=e.target.value;this.setState((function(e){return{filterCourseForm:Object.assign({},e.filterCourseForm,Object(S.a)({},t,a))}}))}},{key:"handleFilterCourse",value:function(){this.setState((function(){return{modalFilterCourseOpen:!1}}))}},{key:"handleClearFilterCourse",value:function(){this.setState((function(){return{filterCourseForm:{cname:"",teacher:"",time:"",location:""},modalFilterCourseOpen:!1}}))}},{key:"render",value:function(){var e=this,t=M()(this.state.courseList),a=!1,n=[],i=this.state.filterCourseForm;return Object.keys(t).reduce((function(r,l){return t[l].isConflict=e.checkConflict(t[l],!1),Object.keys(i).every((function(e){return""===i[e]||(a=!0,!!t[l][e].toUpperCase().includes(i[e].toUpperCase()))}))&&n.push(t[l]),n}),[]),r.a.createElement("div",{style:{background:"#fff",padding:"20px 5px",boxShadow:"0 0 10px 0 #080808"}},r.a.createElement(h.C,{className:"mb-2"},r.a.createElement(h.i,{xs:"12"},this.context.user&&this.context.user.uid&&r.a.createElement(ie,{onSave:this.handleSave,onShare:this.handleShare,onReColor:this.handleReColor,onReTable:this.handleReTable,onClickCustom:this.toggleModalCustomCourse}))),r.a.createElement(h.C,{className:"mb-2"},r.a.createElement(h.i,{xs:"12"},r.a.createElement(re,{tableData:this.state.customTable,onDelSatOrSun:this.handleDelSatOrSun,onDelCourse:this.handleDelCourse,onEditCourse:this.handleOpenEditModal}),r.a.createElement("hr",null))),r.a.createElement(h.C,null,r.a.createElement(h.i,{xs:"12"},r.a.createElement(H,{deptList:this.state.deptList,courseList:n,onChangeDept:this.changeDept,onAddCourse:this.checkConflict,filterConflict:this.state.filterConflict,onFilterConflict:this.filterConflict,filterCourse:a,onFilterCourse:this.toggleModalFilterCourse}))),r.a.createElement(h.s,{id:"ModalEditCourse",isOpen:this.state.modalEditCourse.open,toggle:this.toggleModalEditCourse},r.a.createElement(h.v,{id:"ModalEditCourse__title",toggle:this.toggleModalEditCourse},this.state.modalEditCourse.modalTitle),r.a.createElement(h.t,null,r.a.createElement(h.o,null,r.a.createElement(h.p,{row:!0},r.a.createElement(h.r,{for:"ModalEditCourse__inputTitle",sm:2},"\u6a19\u984c"),r.a.createElement(h.i,{sm:10},r.a.createElement(h.q,{type:"text",id:"ModalEditCourse__inputTitle",defaultValue:this.state.modalEditCourse.title,placeholder:"\u8ab2\u7a0b\u540d\u7a31"}))),r.a.createElement(h.p,{row:!0},r.a.createElement(h.r,{for:"ModalEditCourse__inputDesc",sm:2},"\u5167\u5bb9"),r.a.createElement(h.i,{sm:10},r.a.createElement(h.q,{type:"text",id:"ModalEditCourse__inputDesc",defaultValue:this.state.modalEditCourse.desc,placeholder:"\u6559\u5e2b\u3001\u5730\u9ede"}))),r.a.createElement(h.p,{row:!0},r.a.createElement(h.r,{for:"ModalEditCourse__inputBg",sm:2},"\u6a19\u8a18"),r.a.createElement(h.i,{sm:10},r.a.createElement("input",{id:"ModalEditCourse__inputBg",type:"color",defaultValue:this.state.modalEditCourse.bg||"#ffffff",style:{verticalAlign:"sub",width:"100%"}}))))),r.a.createElement(h.u,null,r.a.createElement(h.c,{color:"primary",onClick:function(){e.handleEditCourse(e.state.modalEditCourse.time,e.state.modalEditCourse.dayOfWeek)}},"\u78ba\u5b9a"))),r.a.createElement(h.s,{id:"ModalCustomCourse",isOpen:this.state.modalCustomCourseOpen,toggle:this.toggleModalCustomCourse},r.a.createElement(h.v,{toggle:this.toggleModalCustomCourse},"\u81ea\u8a02\u6642\u6bb5"),r.a.createElement(h.t,null,r.a.createElement(h.o,null,r.a.createElement(h.p,{row:!0},r.a.createElement(h.r,{for:"ModalCustomCourse__inputTime",sm:2},"\u6642\u9593"),r.a.createElement(h.i,{sm:10},r.a.createElement(h.q,{type:"text",id:"ModalCustomCourse__inputTime",placeholder:"2bcd4jk"}))),r.a.createElement(h.p,{row:!0},r.a.createElement(h.r,{for:"ModalCustomCourse__inputTitle",sm:2},"\u6a19\u984c"),r.a.createElement(h.i,{sm:10},r.a.createElement(h.q,{type:"text",id:"ModalCustomCourse__inputTitle",placeholder:"meeting"}))),r.a.createElement(h.p,{row:!0},r.a.createElement(h.r,{for:"ModalCustomCourse__inputDesc",sm:2},"\u5167\u5bb9"),r.a.createElement(h.i,{sm:10},r.a.createElement(h.q,{type:"text",id:"ModalCustomCourse__inputDesc",placeholder:"R438 with YCC"}))),r.a.createElement(h.p,{row:!0},r.a.createElement(h.r,{for:"ModalCustomCourse__inputBg",sm:2},"\u6a19\u8a18"),r.a.createElement(h.i,{sm:10},r.a.createElement("input",{id:"ModalCustomCourse__inputBg",type:"color",defaultValue:"#ffffff",style:{verticalAlign:"sub",width:"100%"}}))))),r.a.createElement(h.u,null,r.a.createElement(h.c,{color:"primary",onClick:this.handleAddCustomCourse},"\u78ba\u5b9a"))),r.a.createElement(h.s,{id:"ModalFilterCourse",isOpen:this.state.modalFilterCourseOpen,toggle:this.toggleModalFilterCourse},r.a.createElement(h.v,{id:"ModalFilterCourse__title",toggle:this.toggleModalFilterCourse},"\u7be9\u9078\u8ab2\u7a0b"),r.a.createElement(h.t,null,r.a.createElement(h.o,null,r.a.createElement(h.p,{row:!0},r.a.createElement(h.r,{for:"ModalFilterCourse__inputCname",sm:2},"\u8ab2\u540d"),r.a.createElement(h.i,{sm:10},r.a.createElement(h.q,{type:"text",id:"ModalFilterCourse__inputCname",value:this.state.filterCourseForm.cname,onChange:function(t){e.handleFilterCourseChange(t,"cname")},placeholder:"\u8ab2\u7a0b\u540d\u7a31"}))),r.a.createElement(h.p,{row:!0},r.a.createElement(h.r,{for:"ModalFilterCourse__inputTeacher",sm:2},"\u6559\u5e2b"),r.a.createElement(h.i,{sm:10},r.a.createElement(h.q,{type:"text",id:"ModalFilterCourse__inputTeacher",value:this.state.filterCourseForm.teacher,onChange:function(t){e.handleFilterCourseChange(t,"teacher")},placeholder:"\u6388\u8ab2\u6559\u5e2b"}))),r.a.createElement(h.p,{row:!0},r.a.createElement(h.r,{for:"ModalFilterCourse__inputTime",sm:2},"\u6642\u9593"),r.a.createElement(h.i,{sm:10},r.a.createElement(h.q,{type:"text",id:"ModalFilterCourse__inputTime",value:this.state.filterCourseForm.time,onChange:function(t){e.handleFilterCourseChange(t,"time")},placeholder:"1bcd"}))),r.a.createElement(h.p,{row:!0},r.a.createElement(h.r,{for:"ModalFilterCourse__inputLocation",sm:2},"\u6559\u5ba4"),r.a.createElement(h.i,{sm:10},r.a.createElement(h.q,{type:"text",id:"ModalFilterCourse__inputLocation",value:this.state.filterCourseForm.location,onChange:function(t){e.handleFilterCourseChange(t,"location")},placeholder:"\u7ba1268"}))))),r.a.createElement(h.u,null,r.a.createElement(h.c,{color:"primary",onClick:this.handleFilterCourse},"\u7be9\u9078"),r.a.createElement(h.c,{color:"danger",onClick:this.handleClearFilterCourse},"\u53d6\u6d88\u7be9\u9078"))))}}]),a}(r.a.Component);le.contextTypes={user:f.a.object};var oe=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(s.a)(a,[{key:"render",value:function(){return r.a.createElement(N,null,r.a.createElement(le,null))}}]),a}(r.a.Component),ce=a(17),se=a.n(ce),ue=a(41),de=a.n(ue),me=(a(99),a(100),a(23)),he=a.n(me);a(101),a(102);function pe(){var e=Object(m.a)(["\n\tborder-top: 1px solid rgba(0,0,0,.125);\n\tbackground: #fafafa;\n\t&:hover {\n\t\tbackground: #f0f0f0;\n\t\tcursor: pointer;\n\t}\n"]);return pe=function(){return e},e}function fe(){var e=Object(m.a)(["\n\tbackground: #fff;\n\tbox-shadow: 0 0 5px 0 #888888;\n\tposition: absolute;\n\twidth: 100%;\n\tz-index: 1;\n\tleft: 0;\n\ttop: ",";\n\ttransition: all .5s;\n"]);return fe=function(){return e},e}var be=Object(b.b)(h.k)(fe(),(function(e){return e.top})),ge=b.b.div(pe()),ve=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).state={wantTags:[],haveTags:[],desc:"",filterTags:[],published:!1,settingOpen:!0},n.handleChangeWant=n.handleChangeWant.bind(Object(g.a)(n)),n.handleChangeHave=n.handleChangeHave.bind(Object(g.a)(n)),n.handleChangeDesc=n.handleChangeDesc.bind(Object(g.a)(n)),n.handleChangeFilter=n.handleChangeFilter.bind(Object(g.a)(n)),n.handleSave=n.handleSave.bind(Object(g.a)(n)),n.handleFilter=n.handleFilter.bind(Object(g.a)(n)),n.handleToggleSetting=n.handleToggleSetting.bind(Object(g.a)(n)),n}return Object(s.a)(a,[{key:"componentWillReceiveProps",value:function(e){var t=e.exchangeList[this.context.user.uuid]?JSON.parse(e.exchangeList[this.context.user.uuid]):null;t?this.setState({wantTags:t.want,haveTags:t.have,desc:t.desc,published:!0}):this.setState({wantTags:[],haveTags:[],desc:"",published:!1})}},{key:"handleChangeWant",value:function(e){this.setState({wantTags:e})}},{key:"handleChangeHave",value:function(e){this.setState({haveTags:e})}},{key:"handleChangeDesc",value:function(e){this.setState({desc:e.target.value})}},{key:"handleChangeFilter",value:function(e){this.setState({filterTags:e})}},{key:"handleSave",value:function(){this.state.haveTags.length||this.state.wantTags.length?this.props.onSave(this.state.haveTags,this.state.wantTags,this.state.desc):alert("\u8acb\u78ba\u4fdd Tag \u6709\u8b8a\u6210\u7da0\u7da0\u7684 (\u65bc\u8f38\u5165\u6846\u6309\u4e0b Enter)")}},{key:"handleFilter",value:function(e){var t=this.state.filterTags;if(e||!t.length)return e||t.length||alert("\u8acb\u78ba\u4fdd Tag \u6709\u8b8a\u6210\u7da0\u7da0\u7684 (\u65bc\u8f38\u5165\u6846\u6309\u4e0b Enter)"),this.setState({filterTags:[]}),void this.props.onFilter(null);this.props.onFilter(t)}},{key:"handleToggleSetting",value:function(){this.setState((function(e){return{settingOpen:!e.settingOpen}}))}},{key:"render",value:function(){var e=this;return r.a.createElement(be,{className:"pt-3",top:this.state.settingOpen?0:"-".concat(document.getElementById("ExchangeSetting").offsetHeight+32,"px")},r.a.createElement(h.C,null,r.a.createElement(h.i,{xs:"12"},r.a.createElement("div",{id:"ExchangeSetting"},r.a.createElement("h5",null,"\u8a2d\u5b9a\u500b\u4eba\u63db\u8ab2\u8cc7\u8a0a"),r.a.createElement(h.f,{body:!0},r.a.createElement(h.C,null,r.a.createElement(h.i,{className:"d-inline-block",xs:"4"},r.a.createElement(h.r,{for:"ExchangeSetting__inputWant"},"\u60f3\u8981\u7684\u8ab2"),r.a.createElement(he.a,{className:"form-control",id:"ExchangeSetting__inputWant",onlyUnique:!0,value:this.state.wantTags,onChange:this.handleChangeWant})),r.a.createElement(h.i,{className:"d-inline-block",xs:"4"},r.a.createElement(h.r,{for:"ExchangeSetting__inputHave"},"\u4e0d\u9700\u8981\u7684\u8ab2"),r.a.createElement(he.a,{className:"form-control",id:"ExchangeSetting__inputHave",onlyUnique:!0,value:this.state.haveTags,onChange:this.handleChangeHave})),r.a.createElement(h.i,{className:"d-inline-block",xs:"4"},r.a.createElement(h.r,{for:"ExchangeSetting__inputDesc"},"\u88dc\u5145\u8aaa\u660e"),r.a.createElement(h.q,{type:"textarea",id:"ExchangeSetting__inputDesc",rows:"1",value:this.state.desc,onChange:this.handleChangeDesc}))),r.a.createElement(h.C,{className:"mt-2"},r.a.createElement(h.i,{xs:"12"},this.state.published&&r.a.createElement(h.c,{className:"float-right",size:"sm",color:"danger",onClick:function(){e.props.onUnpublish()}},"\u53d6\u6d88\u767c\u4f48"),r.a.createElement(h.c,{className:"float-right mr-2",size:"sm",color:"primary",onClick:this.handleSave},"\u5132\u5b58\u4e26\u767c\u4f48"))))),r.a.createElement("hr",null),r.a.createElement("h5",null,"\u904e\u6ffe\u63db\u8ab2\u8cc7\u8a0a"),r.a.createElement(h.C,null,r.a.createElement(h.i,{xs:"9"},r.a.createElement(he.a,{className:"form-control",id:"Filter__input",onlyUnique:!0,value:this.state.filterTags,onChange:this.handleChangeFilter})),r.a.createElement(h.i,{className:"text-center",xs:"3"},r.a.createElement(h.c,{size:"sm",outline:!0,color:"primary",style:{verticalAlign:"sub"},onClick:function(){return e.handleFilter(!1)}},r.a.createElement("i",{className:"fa fa-filter","aria-hidden":"true"})," ",r.a.createElement("span",{className:"hidden-sm-down"},"\u904e\u6ffe"))," ",r.a.createElement(h.c,{size:"sm",outline:!0,color:"secondary",style:{verticalAlign:"sub"},onClick:function(){return e.handleFilter(!0)}},r.a.createElement("i",{className:"fa fa-refresh","aria-hidden":"true"})," ",r.a.createElement("span",{className:"hidden-sm-down"},"\u6e05\u9664")))),r.a.createElement(h.C,{className:"mt-2"},r.a.createElement(h.i,{className:"text-center",xs:"12"},r.a.createElement(ge,{onClick:this.handleToggleSetting},r.a.createElement("i",{className:"fa fa-bars","aria-hidden":"true"})))))))}}]),a}(r.a.Component);function Ee(){var e=Object(m.a)(["\n\tfont-size: 14px;\n"]);return Ee=function(){return e},e}function Ce(){var e=Object(m.a)(["\n\tborder-bottom: 1px solid #787878;\n"]);return Ce=function(){return e},e}function ke(){var e=Object(m.a)(["\n\tfont-size: 14px;\n\tcolor: #666;\n\tborder-left: 3px solid #bbb;\n"]);return ke=function(){return e},e}function Oe(){var e=Object(m.a)(["\n\tfont-size: 13px;\n\tcolor: #989898\n"]);return Oe=function(){return e},e}function ye(){var e=Object(m.a)(["\n\tcolor: #365899;\n\tfont-weight: bold\n"]);return ye=function(){return e},e}function xe(){var e=Object(m.a)(["\n\tborder-radius: 50px;\n"]);return xe=function(){return e},e}function we(){var e=Object(m.a)(["\n\tpadding: 5px 5px 5px 30px;\n"]);return we=function(){return e},e}ve.contextTypes={user:f.a.object};var je=Object(b.b)(h.f)(we()),Te=b.b.img(xe()),_e=b.b.a(ye()),Ne=b.b.td(Oe()),Se=b.b.div(ke()),Le=b.b.h6(Ce()),Me=b.b.div(Ee()),De=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(s.a)(a,[{key:"render",value:function(){var e=this.props.item;return r.a.createElement(je,null,r.a.createElement(h.C,null,r.a.createElement(h.i,{className:"mt-1",lg:"5",sm:"12",xs:"12"},r.a.createElement("div",null,r.a.createElement("table",null,r.a.createElement("tbody",null,r.a.createElement("tr",null,r.a.createElement("td",{className:"pr-1",rowSpan:"2"},r.a.createElement("a",{href:e.fbLink||"https://fb.com/".concat(e.fbid)},r.a.createElement(Te,{height:"45px",src:"https://graph.facebook.com/".concat(e.fbid,"/picture"),alt:""}))),r.a.createElement("td",null,r.a.createElement(_e,{href:e.fbLink||"https://fb.com/".concat(e.fbid)},e.name))),r.a.createElement("tr",null,r.a.createElement(Ne,null,se()(e.time).utcOffset(8).format("YYYY/MM/DD HH:mm:ss")))))),r.a.createElement(Se,{className:"mt-1 ml-2 pl-1"},e.desc.split("\n").map((function(e,t){return r.a.createElement("div",{key:t},e)})))),r.a.createElement(h.i,{lg:"4",sm:"12",xs:"12"},r.a.createElement(Le,{className:"pl-3"},"\u60f3\u8981\u7684\u8ab2"),e.want.map((function(e,t){return r.a.createElement(Me,{key:t},r.a.createElement(h.b,{color:"secondary",pill:!0},t+1)," ",e)}))),r.a.createElement(h.i,{lg:"3",sm:"12",xs:"12"},r.a.createElement(Le,{className:"pl-3"},"\u4e0d\u9700\u8981\u7684\u8ab2"),e.have.map((function(e,t){return r.a.createElement(Me,{key:t},r.a.createElement(h.b,{color:"secondary",pill:!0},t+1)," ",e)})))))}}]),a}(r.a.PureComponent),Re=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(s.a)(a,[{key:"render",value:function(){return r.a.createElement(h.k,{className:"mb-5",style:{marginTop:"190px",transition:"all .5s"}},this.props.exchangeList.map((function(e,t){return r.a.createElement(h.C,{key:t,className:"mb-2"},r.a.createElement(h.i,{xs:"12"},r.a.createElement(De,{item:e})))})))}}]),a}(r.a.Component),Fe=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).state={exchangeList:{},filter:null},n.db=window.firebase.database(),n.handleSaveExchangeSetting=n.handleSaveExchangeSetting.bind(Object(g.a)(n)),n.handleUnpublish=n.handleUnpublish.bind(Object(g.a)(n)),n.handleFilter=n.handleFilter.bind(Object(g.a)(n)),n.parseList=n.parseList.bind(Object(g.a)(n)),n}return Object(s.a)(a,[{key:"componentDidMount",value:function(){this.getExchangeList()}},{key:"getExchangeList",value:function(){var e=this;this.db.ref("exchangeList/").once("value").then((function(t){var a=t.val()||{};e.setState({exchangeList:a}),window.localStorage["@KeBiau:wtfFBuserlink"]&&JSON.parse(window.localStorage["@KeBiau:wtfFBuserlink"])||de.a.warning("FB \u5e33\u865f\u9023\u7d50\u76ee\u524d\u6709\u554f\u984c\uff0c\u8acb\u898b\u8ad2",{position:"bottom-right",effect:"genie",beep:!1,timeout:"none",onClose:function(){window.localStorage["@KeBiau:wtfFBuserlink"]=JSON.stringify(!0)}})}))}},{key:"handleSaveExchangeSetting",value:function(e,t,a){var n=this,r=this.context.user.displayName,i=this.context.user.uid,l=this.context.user.fbLink||null,o=this.context.user.uuid,c=se()().format();this.db.ref("exchangeList/".concat(o)).set(JSON.stringify({fbid:i,fbLink:l,name:r,want:t,have:e,desc:a,time:c})).then((function(){n.getExchangeList()}))}},{key:"handleUnpublish",value:function(){var e=this;this.db.ref("exchangeList/".concat(this.context.user.uuid)).remove().then((function(){e.getExchangeList()}))}},{key:"handleFilter",value:function(e){this.setState({filter:e})}},{key:"parseList",value:function(){var e=M()(this.state.exchangeList),t=this.state.filter?M()(this.state.filter):null,a=Object.values(e).map((function(e){return JSON.parse(e)}));return a=this.shuffle(a),t&&(a=a.filter((function(e){var a=!1,n=e.have.join("")+e.want.join("");return t.forEach((function(e){n.includes(e)&&(a=!0)})),a}))),a}},{key:"shuffle",value:function(e){for(var t,a,n=e.length;0!==n;)a=Math.floor(Math.random()*n),t=e[n-=1],e[n]=e[a],e[a]=t;return e}},{key:"render",value:function(){var e=this.parseList();return r.a.createElement("div",null,this.context.user&&!this.context.user.uid&&r.a.createElement(h.C,null,r.a.createElement(h.i,{xs:"12"},r.a.createElement(h.a,{className:"text-center mt-3",color:"danger"},"\u8acb\u5148\u767b\u5165"))),this.context.user&&this.context.user.uid&&r.a.createElement("div",null,r.a.createElement(ve,{exchangeList:this.state.exchangeList,onSave:this.handleSaveExchangeSetting,onUnpublish:this.handleUnpublish,onToggleSetting:this.handleToggleSetting,onFilter:this.handleFilter}),r.a.createElement(h.k,{style:{height:"calc(100vh - 52px)",overflow:"auto",background:"#fff"}},!e.length&&r.a.createElement(B,{marginTop:450}),r.a.createElement(h.C,null,r.a.createElement(h.i,{xs:"12"},r.a.createElement(Re,{exchangeList:e})))),r.a.createElement(de.a,{html:!0})))}}]),a}(r.a.Component);Fe.contextTypes={user:f.a.object};var Be=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(s.a)(a,[{key:"render",value:function(){return r.a.createElement(N,this.props,r.a.createElement(Fe,null))}}]),a}(r.a.Component);function Ae(){var e=Object(m.a)(["\n\tbackground: #fff;\n\tpadding: 20px 5px;\n\tbox-shadow: 0 0 10px 0 #080808;\n\tmargin-top: 55px;\n\tmargin-bottom: 55px;\n"]);return Ae=function(){return e},e}var ze=b.b.div(Ae()),Ie=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).state={customTable:"Loading..."},n.db=window.firebase.database(),n}return Object(s.a)(a,[{key:"componentDidMount",value:function(){var e=this,t=this.context.router.route.match.params.hash,a=t.substring(0,t.length-4),n=t.substring(t.length-4,t.length);this.db.ref("sharedTable/".concat(a)).once("value").then((function(t){var a=t.val();if(null!==a){var r=JSON.parse(a)[n];r?e.setState({customTable:r}):e.setState({customTable:"\u9023\u7d50\u7121\u6548"})}else e.setState({customTable:"\u9023\u7d50\u7121\u6548"})}))}},{key:"render",value:function(){return r.a.createElement(N,null,r.a.createElement(ze,null,r.a.createElement(h.C,null,r.a.createElement(h.i,{xs:"12"},"string"===typeof this.state.customTable&&r.a.createElement(h.a,{className:"text-center",color:"warning"},this.state.customTable),"string"!==typeof this.state.customTable&&r.a.createElement(re,{tableData:this.state.customTable,shared:!0})))))}}]),a}(r.a.Component);Ie.contextTypes={router:f.a.object};var Ue=a(42),qe=(a(103),function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(s.a)(a,[{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"mt-2"},r.a.createElement("h5",null,"\u641c\u5c0b\u8ab2\u7a0b"),r.a.createElement(he.a,{className:"form-control",id:"ExchangeSetting__inputWant",value:this.props.filterTags,onChange:this.props.onFilter,onlyUnique:!0}),r.a.createElement("div",{className:"mt-2"},r.a.createElement(h.e,{size:"sm"},r.a.createElement(h.c,{className:1===this.props.sortType?"active":"",onClick:function(){return e.props.onChangeSortType(1)}},"\u6642\u9593\u512a\u5148")," ",r.a.createElement(h.c,{className:2===this.props.sortType?"active":"",onClick:function(){return e.props.onChangeSortType(2)}},"\u8a55\u50f9\u512a\u5148"))))}}]),a}(r.a.Component));a(104);function We(){var e=Object(m.a)(["\n\t\tcolor: #d9534f;\n\t\tfont-weight: bold;\n\t"]);return We=function(){return e},e}function Je(){var e=Object(m.a)(["\n\tflex: 1;\n\tpadding: 7px;\n\ttransition: all .3s;\n\t","\n\n\t&:hover {\n\t\tbackground: #d9534f;\n\t\tcolor: #fff;\n\t\tcursor: pointer;\n\t}\n"]);return Je=function(){return e},e}function He(){var e=Object(m.a)(["\n\t\tcolor: #0275d8;\n\t\tfont-weight: bold;\n\t"]);return He=function(){return e},e}function Pe(){var e=Object(m.a)(["\n\tflex: 1;\n\tpadding: 7px;\n\ttransition: all .3s;\n\t","\n\n\t&:hover {\n\t\tbackground: #0275d8;\n\t\tcolor: #fff;\n\t\tcursor: pointer;\n\t}\n"]);return Pe=function(){return e},e}function Ke(){var e=Object(m.a)(["\n\twhite-space: pre-line;\n"]);return Ke=function(){return e},e}function Ye(){var e=Object(m.a)(["\n\tfont-weight: bold;\n"]);return Ye=function(){return e},e}function Ge(){var e=Object(m.a)(["\n\tfont-size: 12px;\n\tcolor: #90949c;\n"]);return Ge=function(){return e},e}function Ve(){var e=Object(m.a)(["\n\tcolor: #365899;\n\tfont-size: 14px;\n\tfont-weight: bold;\n"]);return Ve=function(){return e},e}function Ze(){var e=Object(m.a)(["\n\tborder-radius: 30px;\n"]);return Ze=function(){return e},e}function $e(){var e=Object(m.a)(["\n\tposition: absolute;\n\tright: 15px;\n\tfont-size: 26px;\n\ttop: 12px;\n\tcursor: pointer;\n\theight: 17px;\n\tline-height: 17px;\n\tcolor: #d9534f;\n\t&:hover {\n\t\tcolor: #c9302c;\n\t}\n"]);return $e=function(){return e},e}function Xe(){var e=Object(m.a)(["\n\tborder-radius: 0;\n\tbox-shadow: 0 0 5px 0px #dddddd;\n"]);return Xe=function(){return e},e}var Qe=Object(b.b)(h.f)(Xe());Qe.DelBtn=b.b.span($e()),Qe.UserImg=b.b.img(Ze()),Qe.Username=b.b.span(Ve()),Qe.Date=b.b.span(Ge()),Qe.Title=b.b.div(Ye()),Qe.Content=b.b.div(Ke()),Qe.LikeBtn=b.b.span(Pe(),(function(e){return e.like&&Object(b.a)(He())})),Qe.DisLikeBtn=b.b.span(Je(),(function(e){return e.dislike&&Object(b.a)(We())}));var et=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(s.a)(a,[{key:"render",value:function(){var e=this,t=this.props.data,a=1===+t.currentUserLike,n=-1===+t.currentUserLike;return r.a.createElement(Qe,{className:"mb-2"},r.a.createElement(h.g,{className:"pb-2"},r.a.createElement("div",{className:"mb-2"},r.a.createElement("table",null,r.a.createElement("tbody",null,r.a.createElement("tr",null,r.a.createElement("td",{className:"pr-2",rowSpan:"2"},r.a.createElement("a",{href:t.fbLink||"https://fb.com/".concat(t.fbid)},r.a.createElement(Qe.UserImg,{src:"https://graph.facebook.com/".concat(t.fbid,"/picture"),height:"55",alt:""}))),r.a.createElement("td",null,r.a.createElement("a",{href:t.fbLink||"https://fb.com/".concat(t.fbid)},r.a.createElement(Qe.Username,null,t.username)),!!t.currentUserPost&&r.a.createElement(Qe.DelBtn,{onClick:function(){e.props.onDel(t.key)}},"\xd7"))),r.a.createElement("tr",null,r.a.createElement("td",null,r.a.createElement(Qe.Date,null,se()(t.time).utcOffset(8).format("YYYY/MM/DD HH:mm:ss"))))))),r.a.createElement("div",null,r.a.createElement(Qe.Title,null,t.cid?"".concat(t.cid," "):"",t.cname,t.teacher?" | ".concat(t.teacher):""),r.a.createElement(Qe.Content,null,t.content)),r.a.createElement("hr",{style:{marginBottom:"5px"}}),r.a.createElement("div",{style:{display:"flex"}},r.a.createElement(Qe.LikeBtn,{className:"text-center",like:!!a,onClick:function(){e.props.onLike(1,t.currentUserLike,t.key)}},r.a.createElement("i",{className:"fa ".concat(a?"fa-thumbs-up":"fa-thumbs-o-up"),"aria-hidden":"true"})," ",t.like[1]||0),r.a.createElement(Qe.DisLikeBtn,{className:"text-center",dislike:!!n,onClick:function(){e.props.onLike(-1,t.currentUserLike,t.key)}},r.a.createElement("i",{className:"fa ".concat(n?"fa-thumbs-down":"fa-thumbs-o-down"),"aria-hidden":"true"})," ",t.like[-1]||0))))}}]),a}(r.a.Component),tt=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(s.a)(a,[{key:"componentWillReceiveProps",value:function(){window.reviewListBricks&&window.reviewListBricks.destroy()}},{key:"componentDidUpdate",value:function(){window.reviewListBricks=new window.Bricklayer(document.querySelector(".bricklayer"))}},{key:"render",value:function(){var e=this;return r.a.createElement(h.h,{className:"mb-3 bricklayer"},this.props.reviewList.map((function(t,a){return r.a.createElement(et,Object.assign({key:a,data:t},e.props))})))}}]),a}(r.a.Component);function at(){var e=Object(m.a)(["\n\toverflow: auto;\n\theight: calc(100vh - 202px);\n"]);return at=function(){return e},e}function nt(){var e=Object(m.a)(["\n\tbackground: #db4437;\n\tcolor: #fff;\n\tpadding: 10px 15px 0px 15px;\n\tposition: absolute;\n\tright: 10px;\n\tbottom: 10px;\n\twidth: 52px;\n\theight: 52px;\n\tborder-radius: 30px;\n\toverflow: hidden;\n\tcursor: pointer;\n\tbox-shadow: 1px 1px 5px 1px #bbbbbb;\n\ttransition: all .3s;\n\t&:hover {\n\t\twidth: 180px;\n\t\tbox-shadow: 1px 1px 5px 1px #787878;\n\t}\n\n\ti.fa {\n\t\tpadding-bottom: 15px;\n\t\tfont-size: 30px;\n\t\tmargin-right: 10px;\n\t}\n"]);return nt=function(){return e},e}function rt(){var e=Object(m.a)(["\n\tbackground: #fff;\n\tposition: relative;\n"]);return rt=function(){return e},e}var it=Object(b.b)(h.k)(rt()),lt=b.b.div(nt()),ot=Object(b.b)(h.C)(at()),ct=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).state={addReviewModalOpen:!1,reviewData:{},likeData:{},sortType:1,filterTags:[]},n.db=window.firebase.database(),n.toggleAddReviewModal=n.toggleAddReviewModal.bind(Object(g.a)(n)),n.handleAddReview=n.handleAddReview.bind(Object(g.a)(n)),n.getReviewList=n.getReviewList.bind(Object(g.a)(n)),n.parseReviewList=n.parseReviewList.bind(Object(g.a)(n)),n.handleFilter=n.handleFilter.bind(Object(g.a)(n)),n.handleChangeSortType=n.handleChangeSortType.bind(Object(g.a)(n)),n.handleDelReview=n.handleDelReview.bind(Object(g.a)(n)),n.handleLike=n.handleLike.bind(Object(g.a)(n)),n.getReviewList(),n}return Object(s.a)(a,[{key:"getReviewList",value:function(){var e,t,a=this;this.db.ref("review").once("value").then((function(t){e=t.val()||{}})).then((function(){a.db.ref("likedReview").once("value").then((function(n){t=n.val()||{},a.setState({reviewData:e,likeData:t})}))}))}},{key:"parseReviewList",value:function(){var e=this,t=M()(this.state.reviewData),a=M()(this.state.likeData),n=this.context.user&&this.context.user.uuid,r=[],i={};for(var l in Object.values(a).forEach((function(e,t){Object.keys(e).forEach((function(t,a){i[t]||(i[t]={}),i[t][e[t]]||(i[t][e[t]]=0),i[t][e[t]]++}))})),t){var o=function(o){var c=JSON.parse(t[l][o]),s=!1;e.state.filterTags.length>0?e.state.filterTags.some((function(e,t){return e=e.toLowerCase(),!!(c.cid.toLowerCase().includes(e)||c.cname.toLowerCase().includes(e)||c.teacher.toLowerCase().includes(e)||c.content.toLowerCase().includes(e))&&(s=!0,!0)})):s=!0,n&&a[n]&&void 0!==a[n][o]&&(c.currentUserLike=a[n][o]),n&&l===n&&(c.currentUserPost=!0),s&&r.push(Object(Ue.a)(Object(Ue.a)({},c),{},{key:o,like:i[o]||{}}))};for(var c in t[l])o(c)}return 1===this.state.sortType?r.sort(this.compareByTime):r.sort(this.compareByLike),r}},{key:"compareByTime",value:function(e,t){return se()(e.time).isBefore(se()(t.time))?1:se()(e.time).isBefore(se()(t.time))?-1:0}},{key:"compareByLike",value:function(e,t){return(e.like[1]||0)<(t.like[1]||0)?1:(e.like[1]||0)>(t.like[1]||0)?-1:0}},{key:"toggleAddReviewModal",value:function(){this.setState((function(e){return{addReviewModalOpen:!e.addReviewModalOpen}}))}},{key:"handleAddReview",value:function(){var e=this,t=document.getElementById("ModalAddReview__inputCname").value,a=document.getElementById("ModalAddReview__inputCid").value,n=document.getElementById("ModalAddReview__inputTeacher").value,r=document.getElementById("ModalAddReview__inputContent").value;if(""!==t&&""!==r){var i=this.context.user.uuid,l=this.context.user.uid,o=this.context.user.fbLink||null,c=this.context.user.displayName,s=se()().format(),u=(Date.now().toString(32)+Math.random().toString(32)).replace(".","");this.db.ref("review/".concat(i,"/").concat(u)).set(JSON.stringify({cname:t,cid:a,teacher:n,content:r,fbid:l,fbLink:o,username:c,time:s})).then((function(){e.toggleAddReviewModal(),e.getReviewList()}))}else alert("\u8ab2\u7a0b\u540d\u7a31\u3001\u8a55\u8ad6\u4e0d\u5f97\u70ba\u7a7a")}},{key:"handleFilter",value:function(e){this.setState({filterTags:e})}},{key:"handleChangeSortType",value:function(e){this.setState({sortType:e})}},{key:"handleDelReview",value:function(e){var t=this;window.confirm("\u78ba\u5b9a\u522a\u9664\u6b64\u7bc7\u8a55\u8ad6\uff1f")&&this.db.ref("review/".concat(this.context.user.uuid,"/").concat(e)).remove().then((function(){t.getReviewList()}))}},{key:"handleLike",value:function(e,t,a){var n=this;e===t?this.db.ref("likedReview/".concat(this.context.user.uuid,"/").concat(a)).remove().then((function(){n.getReviewList()})):this.db.ref("likedReview/".concat(this.context.user.uuid,"/").concat(a)).set(e).then((function(){n.getReviewList()}))}},{key:"render",value:function(){var e=this.parseReviewList();return r.a.createElement("div",null,this.context.user&&!this.context.user.uid&&r.a.createElement(h.C,null,r.a.createElement(h.i,{xs:"12"},r.a.createElement(h.a,{className:"text-center mt-3",color:"danger"},"\u8acb\u5148\u767b\u5165"))),this.context.user&&this.context.user.uid&&r.a.createElement(it,null,r.a.createElement(h.C,{id:"CourseReviewFilter__wrapper"},r.a.createElement(h.i,{xs:"12"},r.a.createElement(qe,{filterTags:this.state.filterTags,onFilter:this.handleFilter,sortType:this.state.sortType,onChangeSortType:this.handleChangeSortType}))),r.a.createElement("hr",null),r.a.createElement(ot,null,r.a.createElement(h.i,{xs:"12"},r.a.createElement(tt,{reviewList:e,onDel:this.handleDelReview,onLike:this.handleLike}))),r.a.createElement(lt,{onClick:this.toggleAddReviewModal},r.a.createElement("i",{className:"fa fa-pencil","aria-hidden":"true"}),"\u7559\u4e0b\u4e00\u5247\u8a55\u8ad6..."),r.a.createElement(h.s,{size:"lg",isOpen:this.state.addReviewModalOpen,toggle:this.toggleAddReviewModal},r.a.createElement(h.v,{toggle:this.toggleAddReviewModal},"\u7559\u4e0b\u4e00\u5247\u8a55\u8ad6"),r.a.createElement(h.t,null,r.a.createElement(h.p,{row:!0},r.a.createElement(h.r,{className:"text-danger",for:"ModalAddReview__inputCname",sm:2},"\u8ab2\u7a0b\u540d\u7a31*"),r.a.createElement(h.i,{sm:10},r.a.createElement(h.q,{type:"text",id:"ModalAddReview__inputCname"}))),r.a.createElement(h.p,{row:!0},r.a.createElement(h.r,{for:"ModalAddReview__inputCid",sm:2},"\u8ab2\u865f"),r.a.createElement(h.i,{sm:10},r.a.createElement(h.q,{type:"text",id:"ModalAddReview__inputCid"}))),r.a.createElement(h.p,{row:!0},r.a.createElement(h.r,{for:"ModalAddReview__inputTeacher",sm:2},"\u6559\u5e2b"),r.a.createElement(h.i,{sm:10},r.a.createElement(h.q,{type:"text",id:"ModalAddReview__inputTeacher"}))),r.a.createElement(h.p,{row:!0},r.a.createElement(h.r,{className:"text-danger",for:"ModalAddReview__inputContent",sm:2},"\u8a55\u8ad6*"),r.a.createElement(h.i,{sm:10},r.a.createElement(h.q,{type:"textarea",name:"text",rows:"5",id:"ModalAddReview__inputContent"})))),r.a.createElement(h.u,null,r.a.createElement(h.c,{color:"primary",block:!0,onClick:this.handleAddReview},"\u9001\u51fa")))))}}]),a}(r.a.Component);ct.contextTypes={user:f.a.object};var st=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(s.a)(a,[{key:"render",value:function(){return r.a.createElement(N,this.props,r.a.createElement(ct,null))}}]),a}(r.a.Component),ut=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function dt(e){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var t=e.installing;t.onstatechange=function(){"installed"===t.state&&(navigator.serviceWorker.controller?console.log("New content is available; please refresh."):console.log("Content is cached for offline use."))}}})).catch((function(e){console.error("Error during service worker registration:",e)}))}window.firebase.initializeApp({apiKey:"AIzaSyDsof_DycXOzeXGVwix3nTgHGZwtseEzJ0",authDomain:"kebiau-7864f.firebaseapp.com",databaseURL:"https://kebiau-7864f.firebaseio.com",projectId:"kebiau-7864f",storageBucket:"kebiau-7864f.appspot.com",messagingSenderId:"223133259969"}),l.a.render(r.a.createElement(o.a,null,r.a.createElement(o.e,null,r.a.createElement(o.d,{exact:!0,path:"/",component:oe}),r.a.createElement(o.d,{path:"/exchange",component:Be}),r.a.createElement(o.d,{exact:!0,path:"/share/:hash",component:Ie}),r.a.createElement(o.d,{path:"/review",component:st}),r.a.createElement(o.c,{from:"*",to:"/"}))),document.getElementById("app")),function(){if("serviceWorker"in navigator){if(new URL("/KeBiau",window.location).origin!==window.location.origin)return;window.addEventListener("load",(function(){var e="".concat("/KeBiau","/service-worker.js");ut?function(e){fetch(e).then((function(t){404===t.status||-1===t.headers.get("content-type").indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):dt(e)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(e):dt(e)}))}}()},60:function(e,t,a){e.exports=a(105)},75:function(e,t,a){}},[[60,1,2]]]);
//# sourceMappingURL=main.19dc1241.chunk.js.map