(this["webpackJsonpke-biau"]=this["webpackJsonpke-biau"]||[]).push([[0],{105:function(e,t,n){},106:function(e,t,n){},107:function(e,t,n){},108:function(e,t,n){"use strict";n.r(t);var a=n(1),r=n.n(a),i=n(20),l=n.n(i),o=n(19),c=(n(65),n(8)),s=n(9),u=n(11),d=n(10),m=n(53),h=n(5),p=n(2),f=n(0),b=n.n(f),g=n(6),v=n(34),E=n.n(v),C=(n(73),n(74),n(4));function k(){var e=Object(h.a)(["\n  @media (max-width: 1000px) and (min-width: 576px) {\n    display: none;\n  }\n"]);return k=function(){return e},e}function O(){var e=Object(h.a)(["\n  border-radius: 50px;\n"]);return O=function(){return e},e}function y(){var e=Object(h.a)(["\n  @media (max-width: 850px) and (min-width: 576px) {\n    display: none;\n  }\n"]);return y=function(){return e},e}function x(){var e=Object(h.a)(["\n  z-index: 5;\n  padding: 0.3rem 1rem;\n"]);return x=function(){return e},e}var w=Object(g.b)(p.z)(x()),j=g.b.span(y()),T=g.b.img(O()),_=g.b.span(k()),N=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(c.a)(this,n),(a=t.call(this,e)).toggleNavbar=a.toggleNavbar.bind(Object(C.a)(a)),a.toggleLoginTooltip=a.toggleLoginTooltip.bind(Object(C.a)(a)),a.toggleLogoutTooltip=a.toggleLogoutTooltip.bind(Object(C.a)(a)),a.state={navbarIsOpen:!1,loginTooltip:!1,logoutTooltip:!1},a}return Object(s.a)(n,[{key:"toggleNavbar",value:function(){this.setState((function(e){return{navbarIsOpen:!e.navbarIsOpen}}))}},{key:"toggleLoginTooltip",value:function(){this.setState((function(e){return{loginTooltip:!e.loginTooltip}}))}},{key:"toggleLogoutTooltip",value:function(){this.setState((function(e){return{logoutTooltip:!e.logoutTooltip}}))}},{key:"handleLogin",value:function(){var e=new window.firebase.auth.FacebookAuthProvider;e.addScope("user_link"),window.firebase.auth().signInWithPopup(e).then((function(e){var t=e.user,n=e.additionalUserInfo,a=t.uid,r=n.profile,i=r.link||"",l=r.picture.data.url;return Promise.allSettled([window.firebase.database().ref("/userLink/".concat(a)).set(i),window.firebase.database().ref("/userPicture/".concat(a)).set(l)])})).then((function(){window.location.reload()})).catch((function(e){var t=e.code,n=e.message;console.error("[".concat(t,"] ").concat(n))}))}},{key:"handleLogout",value:function(){window.firebase.auth().signOut().then((function(){window.location.reload()})).catch((function(e){console.error(e)}))}},{key:"render",value:function(){var e=this.context.router.route,t=this.context.user,n=!!t,a=n&&!!t.uid;return r.a.createElement(w,{color:"dark",dark:!0,expand:"sm"},r.a.createElement(p.A,{href:"https://2yc.tw/KeBiau"},r.a.createElement("img",{src:"".concat("https://2yc.tw/KeBiau","/logo.png"),alt:"",height:"31px"})," ","\u81ea\u5df1\u7684\u8ab2\u8868\u81ea\u5df1\u6392 2.0"),r.a.createElement(p.B,{onClick:this.toggleNavbar}),r.a.createElement(p.j,{isOpen:this.state.navbarIsOpen,navbar:!0},r.a.createElement(p.w,{navbar:!0},r.a.createElement(p.x,null,r.a.createElement(o.b,{className:"/"===e.match.path?"active nav-link":" nav-link",to:"/"},r.a.createElement("i",{className:"fa fa-table","aria-hidden":"true"})," ",r.a.createElement("span",{className:"d-sm-none d-md-inline"},r.a.createElement(j,null,"\u6211\u7684"),"\u8ab2\u8868"))),r.a.createElement(p.x,null,r.a.createElement(o.b,{className:"/exchange"===e.match.path?"active nav-link":" nav-link",to:"/exchange"},r.a.createElement("i",{className:"fa fa-exchange","aria-hidden":"true"})," ",r.a.createElement("span",{className:"d-sm-none d-md-inline"},"\u63db\u8ab2",r.a.createElement(j,null,"\u5e73\u53f0")))),r.a.createElement(p.x,null,r.a.createElement(o.b,{className:"/review"===e.match.path?"active nav-link":" nav-link",to:"/review"},r.a.createElement("i",{className:"fa fa-thumbs-up","aria-hidden":"true"})," ",r.a.createElement("span",{className:"d-sm-none d-md-inline"},r.a.createElement(j,null,"\u8ab2\u7a0b"),"\u8a55\u50f9"))),r.a.createElement(p.x,null,r.a.createElement(p.y,{href:"https://fb.com/MOLi.rocks/posts/2104134533131853",target:"_blank",rel:"noopener noreferrer"},r.a.createElement("span",null,r.a.createElement("i",{className:"fa fa-question-circle","aria-hidden":"true"})," ",r.a.createElement("span",{className:"d-sm-none d-md-inline"},"\u9078\u8ab2\u6559\u5b78")))),r.a.createElement(p.x,null,r.a.createElement(p.y,{href:"https://github.com/x3388638/KeBiau/issues",target:"_blank",rel:"noopener noreferrer"},r.a.createElement("span",null,r.a.createElement("i",{className:"fa fa-exclamation-circle","aria-hidden":"true"})," ",r.a.createElement("span",{className:"d-sm-none d-md-inline"},"\u56de\u5831"))))),r.a.createElement(p.w,{className:"ml-auto",navbar:!0},n&&a&&r.a.createElement(p.x,null,r.a.createElement(p.y,{href:t.fbLink||"https://fb.com/".concat(t.uid),target:"_blank",rel:"noopener noreferrer"},r.a.createElement(T,{src:t.fbPicture,alt:"",height:"21"}),r.a.createElement(_,{className:"ml-2"},t.displayName))),n&&r.a.createElement(p.x,null,a?r.a.createElement(p.y,{id:"LogoutBtn",href:"#",onClick:this.handleLogout},r.a.createElement("i",{className:"fa fa-sign-out","aria-hidden":"true"})," ",r.a.createElement("span",{className:"d-inline d-sm-none"},"\u767b\u51fa"),r.a.createElement(p.E,{delay:{show:0,hide:0},placement:"left",isOpen:this.state.logoutTooltip,target:"LogoutBtn",toggle:this.toggleLogoutTooltip},"\u767b\u51fa")):r.a.createElement(p.y,{id:"LoginBtn",href:"#",onClick:this.handleLogin},r.a.createElement("i",{className:"fa fa-facebook-square","aria-hidden":"true"}),r.a.createElement(p.E,{delay:{show:0,hide:0},placement:"left",isOpen:this.state.loginTooltip,target:"LoginBtn",toggle:this.toggleLoginTooltip},"\u767b\u5165 Facebook"))))))}}]),n}(r.a.Component);N.contextTypes={user:b.a.object,router:b.a.object};n(77);function S(){var e=Object(h.a)(["\n  position: relative;\n"]);return S=function(){return e},e}var L=Object(g.b)(p.k)(S()),M=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(c.a)(this,n),(a=t.call(this,e)).state={user:null},a.db=window.firebase.database(),window.firebase.auth().onAuthStateChanged((function(e){e?Promise.all([a.db.ref("/userLink/".concat(e.uid)).once("value").then((function(e){return e.val()})),a.db.ref("/userPicture/".concat(e.uid)).once("value").then((function(e){return e.val()}))]).then((function(t){var n=Object(m.a)(t,2),r=n[0],i=n[1];r&&i||E.a.warning("\u8acb\u91cd\u65b0\u767b\u5165 FB \u4e26\u5141\u8a31\u300c\u52d5\u614b\u6642\u5831\u9023\u7d50\u300d\u6b0a\u9650\u5b58\u53d6\uff0c\u4ee5\u7372\u5f97\u6700\u4f73\u7684\u4f7f\u7528\u8005\u9ad4\u9a57",{position:"bottom-right",effect:"genie",beep:!1,timeout:"none"}),a.setState({user:Object.assign({},e.providerData[0],{uuid:e.uid,fbLink:r||"",fbPicture:i||""})})})).catch(console.error):a.setState({user:{uid:null}})})),a}return Object(s.a)(n,[{key:"getChildContext",value:function(){return{user:this.state.user}}},{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement(N,null),r.a.createElement(L,null,this.props.children),r.a.createElement(E.a,{html:!0}))}}]),n}(r.a.Component);M.childContextTypes={user:b.a.object};var D=n(22),R=n(12),F=n.n(R),B=n(52);function A(){var e=Object(h.a)(["\n  display: flex;\n  justify-content: center;\n  margin-top: ",";\n"]);return A=function(){return e},e}var z=g.b.div(A(),(function(e){return"".concat(e.marginTop||20,"px")})),I=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"render",value:function(){return r.a.createElement(z,this.props,r.a.createElement(B.BarLoader,{color:"#666",loading:!0,height:5,width:200}))}}]),n}(r.a.PureComponent);function U(){var e=Object(h.a)(["\n  background: #f9f9f9;\n  border-radius: 2px;\n  & span {\n    display: flex;\n    align-items: center;\n    padding: 5px;\n    &.TableRow__link,\n    &.TableRow__btn {\n      justify-content: center;\n    }\n  }\n\n  @media screen and (max-width: 991px) {\n    padding: 5px;\n    box-shadow: 1px 1px 2px 0px #878787;\n    margin-bottom: 10px;\n    grid-template-columns: 1fr 3fr 1fr;\n    grid-template-rows: 1fr 1fr 1fr 1fr;\n    grid-template-areas:\n      'cid cname classes'\n      'teacher teacher teacher'\n      'time time time'\n      'location location location'\n      'link link btn';\n    & span {\n      padding: 0 8px;\n    }\n\n    & span.TableRow__cid {\n      grid-area: cid;\n    }\n    & span.TableRow__cname {\n      grid-area: cname;\n      justify-content: center;\n      font-weight: bold;\n    }\n    & span.TableRow__classes {\n      grid-area: classes;\n      justify-content: flex-end;\n      &::after {\n        content: '\u73ed';\n        padding-left: 2px;\n      }\n    }\n    & span.TableRow__time {\n      grid-area: time;\n      &::before {\n        content: '\u6642\u9593:';\n        padding-right: 2px;\n      }\n    }\n    & span.TableRow__location {\n      grid-area: location;\n      &::before {\n        content: '\u5730\u9ede:';\n        padding-right: 2px;\n      }\n    }\n    & span.TableRow__teacher {\n      grid-area: teacher;\n      &::before {\n        content: '\u6559\u5e2b:';\n        padding-right: 2px;\n      }\n    }\n    & span.TableRow__grade {\n      display: none;\n    }\n    & span.TableRow__link {\n      grid-area: link;\n      justify-content: flex-end;\n    }\n    & span.TableRow__btn {\n      grid-area: btn;\n      & button {\n        width: 100%;\n      }\n    }\n  }\n"]);return U=function(){return e},e}function P(){var e=Object(h.a)(["\n  margin: 0 5px 5px;\n  position: sticky;\n  top: 0;\n  left: 0;\n  background: #fff;\n  z-index: 10;\n  border-bottom: 1px solid #adadad;\n  & span {\n    padding: 10px 0px;\n    font-weight: bold;\n  }\n\n  @media screen and (max-width: 992px) {\n    display: none;\n  }\n"]);return P=function(){return e},e}function q(){var e=Object(h.a)(["\n  display: grid;\n  grid-template-columns: 2fr 3fr 1fr 1fr 2fr 3fr 1fr 1fr 1fr;\n  grid-gap: 2px;\n  margin: 5px;\n"]);return q=function(){return e},e}var W=g.b.div(q()),J=Object(g.b)(W)(P()),H=Object(g.b)(W)(U()),Y=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(c.a)(this,n),(a=t.call(this,e)).state={selected:""},a.handleSelect=a.handleSelect.bind(Object(C.a)(a)),a}return Object(s.a)(n,[{key:"componentDidMount",value:function(){this.setState({selected:"\u901a\u8b58"})}},{key:"handleSelect",value:function(e){this.setState({selected:e.target.value}),this.props.onChangeDept(e.target.value)}},{key:"render",value:function(){return r.a.createElement("div",{className:"mb-2"},r.a.createElement("strong",null,"\u958b\u8ab2\u55ae\u4f4d\uff1a"),r.a.createElement("select",{value:this.state.selected,onChange:this.handleSelect},Object.keys(this.props.deptList).map((function(e,t){return r.a.createElement("option",{key:t,value:e},e)})))," ",r.a.createElement(p.c,{className:this.props.filterCourse?"active":"",color:this.props.filterCourse?"danger":"light",size:"sm",onClick:this.props.onFilterCourse},"\u7be9\u9078\u8ab2\u7a0b")," ",r.a.createElement(p.c,{className:this.props.filterConflict?"active":"",color:this.props.filterConflict?"danger":"light",size:"sm",onClick:this.props.onFilterConflict},this.props.filterConflict?"\u53d6\u6d88\u904e\u6ffe":"\u904e\u6ffe\u885d\u5802"),r.a.createElement("a",{className:"float-right mr-2 text-warning",href:"https://ccweb.ncnu.edu.tw/student/DeptQuerylist.php",target:"_blank",rel:"noopener noreferrer"},r.a.createElement("i",{className:"fa fa-sitemap","aria-hidden":"true"})," \u5404\u7cfb\u6240\u8ab2\u7a0b\u5730\u5716"))}}]),n}(r.a.Component),K=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"render",value:function(){var e=this,t=this.props.courseList;return r.a.createElement("div",null,r.a.createElement(Y,this.props),r.a.createElement("div",{style:{overflow:"auto",maxHeight:"487px",background:"#fff",width:"100%"}},!t.length&&r.a.createElement(I,null),!!t.length&&r.a.createElement(r.a.Fragment,null,r.a.createElement(J,null,r.a.createElement("span",null,"\u8ab2\u865f"),r.a.createElement("span",null,"\u8ab2\u7a0b\u540d\u7a31"),r.a.createElement("span",null,"\u73ed\u5225"),r.a.createElement("span",null,"\u6642\u6bb5"),r.a.createElement("span",null,"\u6388\u8ab2\u5730\u9ede"),r.a.createElement("span",null,"\u6559\u5e2b"),r.a.createElement("span",null,"\u5e74\u7d1a"),r.a.createElement("span",null),r.a.createElement("span",null)),Object.keys(t).map((function(n){return e.props.filterConflict&&t[n].isConflict?null:r.a.createElement(H,{key:n,"data-uuid":n},r.a.createElement("span",{className:"TableRow__cid"},t[n].cid),r.a.createElement("span",{className:"TableRow__cname"},t[n].cname),r.a.createElement("span",{className:"TableRow__classes"},t[n].classes),r.a.createElement("span",{className:"TableRow__time"},t[n].time),r.a.createElement("span",{className:"TableRow__location"},t[n].location),r.a.createElement("span",{className:"TableRow__teacher"},t[n].teacher),r.a.createElement("span",{className:"TableRow__grade"},t[n].grade),r.a.createElement("span",{className:"TableRow__link"},r.a.createElement("a",{href:"https://ccweb.ncnu.edu.tw/student/aspmaker_course_opened_detail_viewview.php?showdetail=&year=".concat(t[n].year,"&courseid=").concat(t[n].cid,"&_class=").concat(t[n].classes,"&modal=0"),target:"_blank",rel:"noopener noreferrer"},"\u8ab2\u7db1"," ",r.a.createElement("i",{className:"fa fa-external-link","aria-hidden":"true"}))),r.a.createElement("span",{className:"TableRow__btn"},r.a.createElement(p.c,{color:"success",size:"sm",disabled:!!t[n].isConflict,onClick:function(){e.props.onAddCourse(t[n],!0)}},t[n].isConflict?"\u885d\u5802":"\u52a0\u5165")))})))))}}]),n}(r.a.Component);function G(){var e=Object(h.a)(["\n  vertical-align: middle !important;\n  background: ",";\n  color: ",";\n  &:hover {\n    background: #fafafa;\n    "," {\n      display: initial;\n    }\n\n    "," {\n      display: initial;\n    }\n  }\n"]);return G=function(){return e},e}function V(){var e=Object(h.a)(["\n  display: none;\n  cursor: pointer;\n  font-size: 14px;\n  &:hover {\n    color: #0275d8;\n  }\n"]);return V=function(){return e},e}function Z(){var e=Object(h.a)(["\n  display: none;\n  cursor: pointer;\n  color: #c9302c !important;\n  font-size: 20px;\n"]);return Z=function(){return e},e}function $(){var e=Object(h.a)(["\n  top: -8px;\n  position: relative;\n"]);return $=function(){return e},e}var X=g.b.span($()),Q=g.b.span(Z()),ee=g.b.i(V()),te=g.b.td(G(),(function(e){return"".concat(e.bg," !important")||!1}),(function(e){if(e.bg){var t=function(e){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null}(e.bg),n=t.r,a=t.g,r=t.b;return Math.sqrt(n*n*.241+a*a*.691+r*r*.068)<125?"#fff":""}return""}),Q,ee);var ne=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(c.a)(this,n),(a=t.call(this,e)).state={mouseEnter:!1},a.handleMouseEnter=a.handleMouseEnter.bind(Object(C.a)(a)),a.handleMouseLeave=a.handleMouseLeave.bind(Object(C.a)(a)),a.handleDel=a.handleDel.bind(Object(C.a)(a)),a.handleEdit=a.handleEdit.bind(Object(C.a)(a)),a}return Object(s.a)(n,[{key:"handleMouseEnter",value:function(){this.setState({mouseEnter:!0})}},{key:"handleMouseLeave",value:function(){this.setState({mouseEnter:!1})}},{key:"handleDel",value:function(e){if(!this.props.shared){var t=e.target.parentNode.parentNode.parentNode.getAttribute("data-time"),n=e.target.parentNode.parentNode.getAttribute("rowspan");this.props.onDelCourse(t,n,this.props.dayOfWeek)}}},{key:"handleEdit",value:function(e){this.props.shared||this.props.onEditCourse({time:e.target.parentNode.parentNode.parentNode.parentNode.getAttribute("data-time"),dayOfWeek:this.props.dayOfWeek,title:this.props.title,desc:this.props.desc,bg:this.props.bg})}},{key:"hexToRgb",value:function(e){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null}},{key:"render",value:function(){return r.a.createElement(te,{bg:this.props.bg,rowSpan:this.props.rowspan||1,onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave},!this.props.shared&&this.props.title&&this.state.mouseEnter&&r.a.createElement("span",{className:"float-right mr-2"},r.a.createElement(Q,{className:"text-danger",onClick:this.handleDel},"\xd7"),r.a.createElement("br",null),r.a.createElement(X,null,r.a.createElement(ee,{className:"fa fa-pencil","aria-hidden":"true",onClick:this.handleEdit}))),this.props.title&&this.props.title,r.a.createElement("br",{className:"uniBR"}),this.props.desc&&this.props.desc)}}]),n}(r.a.Component);function ae(){var e=Object(h.a)(["\n  width: auto;\n  &:hover {\n    "," {\n      display: initial;\n    }\n  }\n"]);return ae=function(){return e},e}function re(){var e=Object(h.a)(["\n  display: none;\n  &:hover {\n    cursor: pointer;\n    color: #c9302c !important;\n  }\n"]);return re=function(){return e},e}var ie=g.b.i(re()),le=g.b.th(ae(),ie),oe=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"componentDidUpdate",value:function(){var e=document.getElementById("CustomTable").className.replace("table-bordered","").trim().split(" ");document.getElementById("CustomTable").className=e.join(" "),setTimeout((function(){document.getElementById("CustomTable").className+=" table-bordered"}),1)}},{key:"render",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement(p.D,{id:"CustomTable",bordered:!0,responsive:!0,size:"sm",style:{background:"#fff",tableLayout:"fixed"}},r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",{style:{width:"60px"}}),r.a.createElement("th",{className:"text-center"},"\u661f\u671f\u4e00"),r.a.createElement("th",{className:"text-center"},"\u661f\u671f\u4e8c"),r.a.createElement("th",{className:"text-center"},"\u661f\u671f\u4e09"),r.a.createElement("th",{className:"text-center"},"\u661f\u671f\u56db"),r.a.createElement("th",{className:"text-center"},"\u661f\u671f\u4e94"),this.props.tableData.sat&&r.a.createElement(le,{className:"text-center"},"\u661f\u671f\u516d"," ",r.a.createElement(ie,{className:"fa fa-times-circle text-danger","aria-hidden":"true",onClick:function(){!e.props.shared&&e.props.onDelSatOrSun("sat")}})),this.props.tableData.sun&&r.a.createElement(le,{className:"text-center"},"\u661f\u671f\u65e5"," ",r.a.createElement(ie,{className:"fa fa-times-circle text-danger","aria-hidden":"true",onClick:function(){!e.props.shared&&e.props.onDelSatOrSun("sun")}})))),r.a.createElement("tbody",null,["a/08","b/09","c/10","d/11","z/12","e/13","f/14","g/15","h/16","i/17","j/18","k/19","l/20","m/21"].map((function(t,n){return r.a.createElement("tr",{"data-time":t,key:n},r.a.createElement("th",{className:"text-center"},t),Object.keys(e.props.tableData.course[t]).map((function(n,a){var i=e.props.tableData.course[t][n];return null===i?null:(e.props.tableData.sat||"5"!==n)&&(e.props.tableData.sun||"6"!==n)?r.a.createElement(ne,Object.assign({},i,{key:a,dayOfWeek:n,shared:e.props.shared,onDelCourse:e.props.onDelCourse,onEditCourse:e.props.onEditCourse})):null})))})))))}}]),n}(r.a.Component),ce=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(c.a)(this,n),(a=t.call(this,e)).state={exportDropdownOpen:!1,clearDropdownOpen:!1},a.toggleExportDropdown=a.toggleExportDropdown.bind(Object(C.a)(a)),a.toggleClearDropdown=a.toggleClearDropdown.bind(Object(C.a)(a)),a}return Object(s.a)(n,[{key:"toggleExportDropdown",value:function(){this.setState((function(e){return{exportDropdownOpen:!e.exportDropdownOpen}}))}},{key:"toggleClearDropdown",value:function(){this.setState((function(e){return{clearDropdownOpen:!e.clearDropdownOpen}}))}},{key:"handleExportExcel",value:function(e){document.querySelectorAll(".uniBR").forEach((function(e){e.setAttribute("style","mso-data-placement:same-cell")}));var t='<html><head><meta charset="utf-8"></head><body>'+document.getElementById("CustomTable").parentNode.innerHTML+"</body></html>";window.open("data:application/vnd.ms-excel,"+encodeURIComponent(t)),e.preventDefault()}},{key:"handleExportPNG",value:function(){window.html2canvas(document.querySelectorAll("#CustomTable"),{onrendered:function(e){}}),window.html2canvas(document.querySelectorAll("#CustomTable"),{onrendered:function(e){window.Canvas2Image.saveAsPNG(e)}})}},{key:"render",value:function(){var e={cursor:"pointer",marginBottom:"5px"};return r.a.createElement("div",null,r.a.createElement(p.c,{color:"primary",size:"sm",className:"mr-1",style:e,onClick:this.props.onSave},r.a.createElement("i",{className:"fa fa-floppy-o","aria-hidden":"true"})," ",r.a.createElement("span",{className:"d-none d-sm-inline"},"\u5132\u5b58")),r.a.createElement(p.c,{color:"light",size:"sm",className:"mr-1",style:e,onClick:this.props.onShare},r.a.createElement("i",{className:"fa fa-share-square-o","aria-hidden":"true"})," ",r.a.createElement("span",{className:"d-none d-sm-inline"},"\u5206\u4eab")),r.a.createElement(p.d,{className:"mr-1",isOpen:this.state.exportDropdownOpen,style:e,size:"sm",toggle:this.toggleExportDropdown},r.a.createElement(p.n,{caret:!0,color:"light"},r.a.createElement("i",{className:"fa fa-download","aria-hidden":"true"})," ",r.a.createElement("span",{className:"d-none d-sm-inline"},"\u532f\u51fa")),r.a.createElement(p.m,null,r.a.createElement(p.l,{onClick:this.handleExportExcel},r.a.createElement("i",{className:"fa fa-file-excel-o","aria-hidden":"true"})," .xls"),r.a.createElement(p.l,{onClick:this.handleExportPNG},r.a.createElement("i",{className:"fa fa-file-image-o","aria-hidden":"true"})," .png"))),r.a.createElement("span",{className:"ml-2 mr-2"}),r.a.createElement(p.d,{className:"mr-1",isOpen:this.state.clearDropdownOpen,style:e,size:"sm",toggle:this.toggleClearDropdown},r.a.createElement(p.n,{caret:!0,color:"light"},r.a.createElement("i",{className:"fa fa-repeat","aria-hidden":"true"})," ",r.a.createElement("span",{className:"d-none d-sm-inline"},"\u6e05\u9664")),r.a.createElement(p.m,null,r.a.createElement(p.l,{onClick:this.props.onReColor},r.a.createElement("i",{className:"fa fa-magic","aria-hidden":"true"})," \u6a19\u8a18"),r.a.createElement(p.l,{onClick:this.props.onReTable},r.a.createElement("i",{className:"fa fa-table","aria-hidden":"true"})," \u8ab2\u8868"))),r.a.createElement(p.c,{color:"light",size:"sm",className:"mr-1",style:e,onClick:this.props.onClickCustom},r.a.createElement("i",{className:"fa fa-plus","aria-hidden":"true"})," ",r.a.createElement("span",{className:"d-none d-sm-inline"},"\u81ea\u8a02\u6642\u6bb5")))}}]),n}(r.a.Component),se=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(c.a)(this,n),(a=t.call(this,e)).state={deptList:{},courseList:{},customTable:{course:{"a/08":{0:{},1:{},2:{},3:{},4:{},5:{},6:{}},"b/09":{0:{},1:{},2:{},3:{},4:{},5:{},6:{}},"c/10":{0:{},1:{},2:{},3:{},4:{},5:{},6:{}},"d/11":{0:{},1:{},2:{},3:{},4:{},5:{},6:{}},"z/12":{0:{},1:{},2:{},3:{},4:{},5:{},6:{}},"e/13":{0:{},1:{},2:{},3:{},4:{},5:{},6:{}},"f/14":{0:{},1:{},2:{},3:{},4:{},5:{},6:{}},"g/15":{0:{},1:{},2:{},3:{},4:{},5:{},6:{}},"h/16":{0:{},1:{},2:{},3:{},4:{},5:{},6:{}},"i/17":{0:{},1:{},2:{},3:{},4:{},5:{},6:{}},"j/18":{0:{},1:{},2:{},3:{},4:{},5:{},6:{}},"k/19":{0:{},1:{},2:{},3:{},4:{},5:{},6:{}},"l/20":{0:{},1:{},2:{},3:{},4:{},5:{},6:{}},"m/21":{0:{},1:{},2:{},3:{},4:{},5:{},6:{}}},sat:!1,sun:!1},modalEditCourse:{open:!1,modalTitle:"\u7de8\u8f2f\u8ab2\u7a0b",title:"",desc:"",bg:""},modalCustomCourseOpen:!1,filterConflict:!1,modalFilterCourseOpen:!1,filterCourseForm:{cname:"",teacher:"",time:"",location:""}},a.timeMap={a:"a/08",b:"b/09",c:"c/10",d:"d/11",z:"z/12",e:"e/13",f:"f/14",g:"g/15",h:"h/16",i:"i/17",j:"j/18",k:"k/19",l:"l/20",m:"m/21"},a.timeOrder=["a","b","c","d","z","e","f","g","h","i","j","k","l","m"],a.db=window.firebase.database(),a.getCourseList=a.getCourseList.bind(Object(C.a)(a)),a.getCourseData=a.getCourseData.bind(Object(C.a)(a)),a.changeDept=a.changeDept.bind(Object(C.a)(a)),a.getTableData=a.getTableData.bind(Object(C.a)(a)),a.checkConflict=a.checkConflict.bind(Object(C.a)(a)),a.handleDelSatOrSun=a.handleDelSatOrSun.bind(Object(C.a)(a)),a.handleDelCourse=a.handleDelCourse.bind(Object(C.a)(a)),a.handleOpenEditModal=a.handleOpenEditModal.bind(Object(C.a)(a)),a.toggleModalEditCourse=a.toggleModalEditCourse.bind(Object(C.a)(a)),a.handleEditCourse=a.handleEditCourse.bind(Object(C.a)(a)),a.handleReColor=a.handleReColor.bind(Object(C.a)(a)),a.handleReTable=a.handleReTable.bind(Object(C.a)(a)),a.toggleModalCustomCourse=a.toggleModalCustomCourse.bind(Object(C.a)(a)),a.handleAddCustomCourse=a.handleAddCustomCourse.bind(Object(C.a)(a)),a.handleSave=a.handleSave.bind(Object(C.a)(a)),a.handleShare=a.handleShare.bind(Object(C.a)(a)),a.filterConflict=a.filterConflict.bind(Object(C.a)(a)),a.toggleModalFilterCourse=a.toggleModalFilterCourse.bind(Object(C.a)(a)),a.handleFilterCourse=a.handleFilterCourse.bind(Object(C.a)(a)),a.handleClearFilterCourse=a.handleClearFilterCourse.bind(Object(C.a)(a)),a.handleFilterCourseChange=a.handleFilterCourseChange.bind(Object(C.a)(a)),a}return Object(s.a)(n,[{key:"componentDidMount",value:function(){this.getCourseData(),this.getTableData()}},{key:"getCourseList",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"\u901a\u8b58",n=window.sessionStorage.courseList?JSON.parse(window.sessionStorage.courseList):"{}";this.db.ref("course/".concat(t)).once("value").then((function(a){e.setState({courseList:a.val()||{}}),window.sessionStorage.courseList=JSON.stringify(Object.assign({},n,Object(D.a)({},t,a.val())))}))}},{key:"getCourseData",value:function(){var e=this;this.db.ref("deptList/").once("value").then((function(t){window.sessionStorage.deptList=JSON.stringify(t.val()||{}),e.setState({deptList:t.val()||{}})})),this.getCourseList()}},{key:"changeDept",value:function(e){this.getCourseList(e)}},{key:"getTableData",value:function(){var e=this,t=this.context.user;null!==t?t.uid&&this.db.ref("customTable/".concat(t.uuid)).once("value").then((function(t){var n=t.val();n&&e.setState({customTable:Object.assign({},JSON.parse(n))})})):setTimeout(this.getTableData,100)}},{key:"checkConflict",value:function(e,t){var n=this,a=e.time.toLowerCase(),r=this.apartCourseTime(a),i=!0;if(r.some((function(e){var a=n.validateTime(e);return!a.valid&&(t&&alert(a.msg),i=!1,!0)})),i){var l=!1,o=F()(this.state.customTable);return r.forEach((function(a,r){if(!l){var i=a,c=i[0],s=i[1],u=i.length-1;if(null===o.course[n.timeMap[s]][c-1]||o.course[n.timeMap[s]][c-1].title)l=!0;else{t&&(o.course[n.timeMap[s]][c-1]={rowspan:u,title:e.cname||e.title,desc:e.desc||"".concat(e.location," ").concat(e.teacher),bg:e.bg||""});for(var d=n.timeOrder.indexOf(s)+1,m=n.timeMap[n.timeOrder[d]],h=0;h<u-1;h++){var p=o.course[m][c-1];if(null===p||p.title)return void(l=!0);t&&(o.course[m][c-1]=null),d++,m=n.timeMap[n.timeOrder[d]]}t&&("6"!==c||o.sat||(o.sat=!0),"7"!==c||o.sun||(o.sun=!0))}}})),l&&t?void alert("!!! \u885d\u5802 !!!"):(t&&this.setState({customTable:F()(o)}),l)}return!1}},{key:"validateTime",value:function(e){if(/^[1-7]{1}[A-MZa-mz]+$/.test(e)){for(var t=-1,n=0,a=1;a<e.length;a++){var r=e[a].charCodeAt();if(-1!==t){if(122===r){if(100!==t){n++;break}t=r;continue}if(101===r){if(122!==t){n++;break}t=r;continue}if(r!==+t+1){n++;break}}t=r}return n?{valid:!1,msg:"\u6642\u6bb5\u4e0d\u9023\u7e8c"}:{valid:!0}}return{valid:!1,msg:"\u6642\u9593\u683c\u5f0f\u932f\u8aa4"}}},{key:"apartCourseTime",value:function(e){var t=[];return""===e?["zzzzz"]:e.replace(/[1-7]{1}[A-MZa-mz]+/g,"").length>0?(t.push(e),t):e.match(/[1-7]{1}[A-MZa-mz]+/g)}},{key:"handleDelSatOrSun",value:function(e){var t=F()(this.state.customTable);t[e]=!1;var n="sat"===e?5:6;Object.keys(t.course).forEach((function(e,a){t.course[e][n]={}})),this.setState({customTable:F()(t)})}},{key:"handleDelCourse",value:function(e,t,n){var a=F()(this.state.customTable);a.course[e][n]={};for(var r=this.timeOrder.indexOf(e[0])+1,i=this.timeMap[this.timeOrder[r]],l=0;l<t-1;l++)a.course[i][n]={},r++,i=this.timeMap[this.timeOrder[r]];this.setState({customTable:F()(a)})}},{key:"handleOpenEditModal",value:function(e){var t=F()(this.state.modalEditCourse);t.open=!0,t.modalTitle="\u7de8\u8f2f ".concat(e.title),t.title=e.title,t.desc=e.desc,t.bg=e.bg,t.time=e.time,t.dayOfWeek=e.dayOfWeek,this.setState({modalEditCourse:F()(t)})}},{key:"toggleModalEditCourse",value:function(){var e=F()(this.state.modalEditCourse);e.open=!e.open,this.setState({modalEditCourse:F()(e)})}},{key:"handleEditCourse",value:function(e,t){if(""!==document.getElementById("ModalEditCourse__inputTitle").value){var n=F()(this.state.modalEditCourse);n.open=!1;var a=F()(this.state.customTable);a.course[e][t].title=document.getElementById("ModalEditCourse__inputTitle").value,a.course[e][t].desc=document.getElementById("ModalEditCourse__inputDesc").value,a.course[e][t].bg=document.getElementById("ModalEditCourse__inputBg").value,this.setState({modalEditCourse:F()(n),customTable:F()(a)})}else alert("\u6a19\u984c\u4e0d\u5f97\u70ba\u7a7a")}},{key:"handleReColor",value:function(){var e=F()(this.state.customTable);Object.keys(e.course).forEach((function(t){Object.keys(e.course[t]).forEach((function(n){e.course[t][n]&&(e.course[t][n].bg="")}))})),this.setState({customTable:F()(e)})}},{key:"handleReTable",value:function(){var e=F()(this.state.customTable);Object.keys(e.course).forEach((function(t){Object.keys(e.course[t]).forEach((function(n){e.course[t][n]={}}))})),e.sat=!1,e.sun=!1,this.setState({customTable:F()(e)})}},{key:"toggleModalCustomCourse",value:function(){this.setState((function(e){return{modalCustomCourseOpen:!e.modalCustomCourseOpen}}))}},{key:"handleAddCustomCourse",value:function(){var e=document.getElementById("ModalCustomCourse__inputTime").value,t=document.getElementById("ModalCustomCourse__inputTitle").value;e&&t?(this.checkConflict({time:e,title:t,desc:document.getElementById("ModalCustomCourse__inputDesc").value||" ",bg:document.getElementById("ModalCustomCourse__inputBg").value},!0),this.toggleModalCustomCourse()):alert("\u6642\u9593\u3001\u6a19\u984c\u4e0d\u5f97\u70ba\u7a7a")}},{key:"handleSave",value:function(){this.db.ref("customTable/".concat(this.context.user.uuid)).set(JSON.stringify(this.state.customTable)).then((function(){alert("\u5132\u5b58\u6210\u529f!")}))}},{key:"handleShare",value:function(){var e=this.context.user.uuid,t=(Date.now()*Math.random()*Math.random()).toString(16).replace(".","").substring(2,6);this.db.ref("sharedTable/".concat(e)).set(JSON.stringify(Object(D.a)({},t,this.state.customTable))).then((function(){prompt("\u5df2\u5c07\u7576\u524d\u8ab2\u8868\u5206\u4eab\u65bc\u4ee5\u4e0b\u9023\u7d50","".concat("https://2yc.tw/KeBiau","/#/share/").concat(e).concat(t))}))}},{key:"filterConflict",value:function(){this.setState((function(e){return{filterConflict:!e.filterConflict}}))}},{key:"toggleModalFilterCourse",value:function(){this.setState((function(e){return{modalFilterCourseOpen:!e.modalFilterCourseOpen}}))}},{key:"handleFilterCourseChange",value:function(e,t){var n=e.target.value;this.setState((function(e){return{filterCourseForm:Object.assign({},e.filterCourseForm,Object(D.a)({},t,n))}}))}},{key:"handleFilterCourse",value:function(){this.setState((function(){return{modalFilterCourseOpen:!1}}))}},{key:"handleClearFilterCourse",value:function(){this.setState((function(){return{filterCourseForm:{cname:"",teacher:"",time:"",location:""},modalFilterCourseOpen:!1}}))}},{key:"render",value:function(){var e=this,t=F()(this.state.courseList),n=!1,a=[],i=this.state.filterCourseForm;return Object.keys(t).reduce((function(r,l){return t[l].isConflict=e.checkConflict(t[l],!1),Object.keys(i).every((function(e){return""===i[e]||(n=!0,!!t[l][e].toUpperCase().includes(i[e].toUpperCase()))}))&&a.push(t[l]),a}),[]),r.a.createElement("div",{style:{background:"#fff",padding:"20px 5px",boxShadow:"0 0 10px 0 #080808"}},r.a.createElement(p.C,{className:"mb-2"},r.a.createElement(p.i,{xs:"12"},this.context.user&&this.context.user.uid&&r.a.createElement(ce,{onSave:this.handleSave,onShare:this.handleShare,onReColor:this.handleReColor,onReTable:this.handleReTable,onClickCustom:this.toggleModalCustomCourse}))),r.a.createElement(p.C,{className:"mb-2"},r.a.createElement(p.i,{xs:"12"},r.a.createElement(oe,{tableData:this.state.customTable,onDelSatOrSun:this.handleDelSatOrSun,onDelCourse:this.handleDelCourse,onEditCourse:this.handleOpenEditModal}),r.a.createElement("hr",null))),r.a.createElement(p.C,null,r.a.createElement(p.i,{xs:"12"},r.a.createElement(K,{deptList:this.state.deptList,courseList:a,onChangeDept:this.changeDept,onAddCourse:this.checkConflict,filterConflict:this.state.filterConflict,onFilterConflict:this.filterConflict,filterCourse:n,onFilterCourse:this.toggleModalFilterCourse}))),r.a.createElement(p.s,{id:"ModalEditCourse",isOpen:this.state.modalEditCourse.open,toggle:this.toggleModalEditCourse},r.a.createElement(p.v,{id:"ModalEditCourse__title",toggle:this.toggleModalEditCourse},this.state.modalEditCourse.modalTitle),r.a.createElement(p.t,null,r.a.createElement(p.o,null,r.a.createElement(p.p,{row:!0},r.a.createElement(p.r,{for:"ModalEditCourse__inputTitle",sm:2},"\u6a19\u984c"),r.a.createElement(p.i,{sm:10},r.a.createElement(p.q,{type:"text",id:"ModalEditCourse__inputTitle",defaultValue:this.state.modalEditCourse.title,placeholder:"\u8ab2\u7a0b\u540d\u7a31"}))),r.a.createElement(p.p,{row:!0},r.a.createElement(p.r,{for:"ModalEditCourse__inputDesc",sm:2},"\u5167\u5bb9"),r.a.createElement(p.i,{sm:10},r.a.createElement(p.q,{type:"text",id:"ModalEditCourse__inputDesc",defaultValue:this.state.modalEditCourse.desc,placeholder:"\u6559\u5e2b\u3001\u5730\u9ede"}))),r.a.createElement(p.p,{row:!0},r.a.createElement(p.r,{for:"ModalEditCourse__inputBg",sm:2},"\u6a19\u8a18"),r.a.createElement(p.i,{sm:10},r.a.createElement("input",{id:"ModalEditCourse__inputBg",type:"color",defaultValue:this.state.modalEditCourse.bg||"#ffffff",style:{verticalAlign:"sub",width:"100%"}}))))),r.a.createElement(p.u,null,r.a.createElement(p.c,{color:"primary",onClick:function(){e.handleEditCourse(e.state.modalEditCourse.time,e.state.modalEditCourse.dayOfWeek)}},"\u78ba\u5b9a"))),r.a.createElement(p.s,{id:"ModalCustomCourse",isOpen:this.state.modalCustomCourseOpen,toggle:this.toggleModalCustomCourse},r.a.createElement(p.v,{toggle:this.toggleModalCustomCourse},"\u81ea\u8a02\u6642\u6bb5"),r.a.createElement(p.t,null,r.a.createElement(p.o,null,r.a.createElement(p.p,{row:!0},r.a.createElement(p.r,{for:"ModalCustomCourse__inputTime",sm:2},"\u6642\u9593"),r.a.createElement(p.i,{sm:10},r.a.createElement(p.q,{type:"text",id:"ModalCustomCourse__inputTime",placeholder:"2bcd4jk"}))),r.a.createElement(p.p,{row:!0},r.a.createElement(p.r,{for:"ModalCustomCourse__inputTitle",sm:2},"\u6a19\u984c"),r.a.createElement(p.i,{sm:10},r.a.createElement(p.q,{type:"text",id:"ModalCustomCourse__inputTitle",placeholder:"meeting"}))),r.a.createElement(p.p,{row:!0},r.a.createElement(p.r,{for:"ModalCustomCourse__inputDesc",sm:2},"\u5167\u5bb9"),r.a.createElement(p.i,{sm:10},r.a.createElement(p.q,{type:"text",id:"ModalCustomCourse__inputDesc",placeholder:"R438 with YCC"}))),r.a.createElement(p.p,{row:!0},r.a.createElement(p.r,{for:"ModalCustomCourse__inputBg",sm:2},"\u6a19\u8a18"),r.a.createElement(p.i,{sm:10},r.a.createElement("input",{id:"ModalCustomCourse__inputBg",type:"color",defaultValue:"#ffffff",style:{verticalAlign:"sub",width:"100%"}}))))),r.a.createElement(p.u,null,r.a.createElement(p.c,{color:"primary",onClick:this.handleAddCustomCourse},"\u78ba\u5b9a"))),r.a.createElement(p.s,{id:"ModalFilterCourse",isOpen:this.state.modalFilterCourseOpen,toggle:this.toggleModalFilterCourse},r.a.createElement(p.v,{id:"ModalFilterCourse__title",toggle:this.toggleModalFilterCourse},"\u7be9\u9078\u8ab2\u7a0b"),r.a.createElement(p.t,null,r.a.createElement(p.o,null,r.a.createElement(p.p,{row:!0},r.a.createElement(p.r,{for:"ModalFilterCourse__inputCname",sm:2},"\u8ab2\u540d"),r.a.createElement(p.i,{sm:10},r.a.createElement(p.q,{type:"text",id:"ModalFilterCourse__inputCname",value:this.state.filterCourseForm.cname,onChange:function(t){e.handleFilterCourseChange(t,"cname")},placeholder:"\u8ab2\u7a0b\u540d\u7a31"}))),r.a.createElement(p.p,{row:!0},r.a.createElement(p.r,{for:"ModalFilterCourse__inputTeacher",sm:2},"\u6559\u5e2b"),r.a.createElement(p.i,{sm:10},r.a.createElement(p.q,{type:"text",id:"ModalFilterCourse__inputTeacher",value:this.state.filterCourseForm.teacher,onChange:function(t){e.handleFilterCourseChange(t,"teacher")},placeholder:"\u6388\u8ab2\u6559\u5e2b"}))),r.a.createElement(p.p,{row:!0},r.a.createElement(p.r,{for:"ModalFilterCourse__inputTime",sm:2},"\u6642\u9593"),r.a.createElement(p.i,{sm:10},r.a.createElement(p.q,{type:"text",id:"ModalFilterCourse__inputTime",value:this.state.filterCourseForm.time,onChange:function(t){e.handleFilterCourseChange(t,"time")},placeholder:"1bcd"}))),r.a.createElement(p.p,{row:!0},r.a.createElement(p.r,{for:"ModalFilterCourse__inputLocation",sm:2},"\u6559\u5ba4"),r.a.createElement(p.i,{sm:10},r.a.createElement(p.q,{type:"text",id:"ModalFilterCourse__inputLocation",value:this.state.filterCourseForm.location,onChange:function(t){e.handleFilterCourseChange(t,"location")},placeholder:"\u7ba1268"}))))),r.a.createElement(p.u,null,r.a.createElement(p.c,{color:"primary",onClick:this.handleFilterCourse},"\u7be9\u9078"),r.a.createElement(p.c,{color:"danger",onClick:this.handleClearFilterCourse},"\u53d6\u6d88\u7be9\u9078"))))}}]),n}(r.a.Component);se.contextTypes={user:b.a.object};var ue=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"render",value:function(){return r.a.createElement(M,null,r.a.createElement(se,null))}}]),n}(r.a.Component),de=n(18),me=n.n(de),he=n(23),pe=n.n(he);n(104),n(105);function fe(){var e=Object(h.a)(["\n  border-top: 1px solid rgba(0, 0, 0, 0.125);\n  background: #fafafa;\n  &:hover {\n    background: #f0f0f0;\n    cursor: pointer;\n  }\n"]);return fe=function(){return e},e}function be(){var e=Object(h.a)(["\n  background: #fff;\n  box-shadow: 0 0 5px 0 #888888;\n  position: absolute;\n  width: 100%;\n  z-index: 1;\n  left: 0;\n  top: ",";\n  transition: all 0.5s;\n"]);return be=function(){return e},e}var ge=Object(g.b)(p.k)(be(),(function(e){return e.top})),ve=g.b.div(fe()),Ee=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(c.a)(this,n),(a=t.call(this,e)).state={wantTags:[],haveTags:[],desc:"",filterTags:[],published:!1,settingOpen:!0},a.handleChangeWant=a.handleChangeWant.bind(Object(C.a)(a)),a.handleChangeHave=a.handleChangeHave.bind(Object(C.a)(a)),a.handleChangeDesc=a.handleChangeDesc.bind(Object(C.a)(a)),a.handleChangeFilter=a.handleChangeFilter.bind(Object(C.a)(a)),a.handleSave=a.handleSave.bind(Object(C.a)(a)),a.handleFilter=a.handleFilter.bind(Object(C.a)(a)),a.handleToggleSetting=a.handleToggleSetting.bind(Object(C.a)(a)),a.setSettingsFromProps=a.setSettingsFromProps.bind(Object(C.a)(a)),a}return Object(s.a)(n,[{key:"componentDidMount",value:function(){this.setSettingsFromProps(this.props)}},{key:"componentWillReceiveProps",value:function(e){this.setSettingsFromProps(e)}},{key:"setSettingsFromProps",value:function(e){var t=e.exchangeList[this.context.user.uuid]?JSON.parse(e.exchangeList[this.context.user.uuid]):null;t?this.setState({wantTags:t.want,haveTags:t.have,desc:t.desc,published:!0}):this.setState({wantTags:[],haveTags:[],desc:"",published:!1})}},{key:"handleChangeWant",value:function(e){this.setState({wantTags:e})}},{key:"handleChangeHave",value:function(e){this.setState({haveTags:e})}},{key:"handleChangeDesc",value:function(e){this.setState({desc:e.target.value})}},{key:"handleChangeFilter",value:function(e){this.setState({filterTags:e})}},{key:"handleSave",value:function(){this.state.haveTags.length||this.state.wantTags.length?this.props.onSave(this.state.haveTags,this.state.wantTags,this.state.desc):alert("\u8acb\u78ba\u4fdd Tag \u6709\u8b8a\u6210\u7da0\u7da0\u7684 (\u65bc\u8f38\u5165\u6846\u6309\u4e0b Enter)")}},{key:"handleFilter",value:function(e){var t=this.state.filterTags;if(e||!t.length)return e||t.length||alert("\u8acb\u78ba\u4fdd Tag \u6709\u8b8a\u6210\u7da0\u7da0\u7684 (\u65bc\u8f38\u5165\u6846\u6309\u4e0b Enter)"),this.setState({filterTags:[]}),void this.props.onFilter(null);this.props.onFilter(t)}},{key:"handleToggleSetting",value:function(){this.setState((function(e){return{settingOpen:!e.settingOpen}}))}},{key:"render",value:function(){var e=this;return r.a.createElement(ge,{className:"pt-3",top:this.state.settingOpen?0:"-".concat(document.getElementById("ExchangeSetting").offsetHeight+32,"px")},r.a.createElement(p.C,null,r.a.createElement(p.i,{xs:"12"},r.a.createElement("div",{id:"ExchangeSetting"},r.a.createElement("h5",null,"\u8a2d\u5b9a\u500b\u4eba\u63db\u8ab2\u8cc7\u8a0a"),r.a.createElement(p.f,{body:!0},r.a.createElement(p.C,null,r.a.createElement(p.i,{className:"d-inline-block",xs:"4"},r.a.createElement(p.r,{for:"ExchangeSetting__inputWant"},"\u60f3\u8981\u7684\u8ab2"),r.a.createElement(pe.a,{className:"form-control",id:"ExchangeSetting__inputWant",onlyUnique:!0,value:this.state.wantTags,onChange:this.handleChangeWant})),r.a.createElement(p.i,{className:"d-inline-block",xs:"4"},r.a.createElement(p.r,{for:"ExchangeSetting__inputHave"},"\u4e0d\u9700\u8981\u7684\u8ab2"),r.a.createElement(pe.a,{className:"form-control",id:"ExchangeSetting__inputHave",onlyUnique:!0,value:this.state.haveTags,onChange:this.handleChangeHave})),r.a.createElement(p.i,{className:"d-inline-block",xs:"4"},r.a.createElement(p.r,{for:"ExchangeSetting__inputDesc"},"\u88dc\u5145\u8aaa\u660e"),r.a.createElement(p.q,{type:"textarea",id:"ExchangeSetting__inputDesc",rows:"1",value:this.state.desc,onChange:this.handleChangeDesc}))),r.a.createElement(p.C,{className:"mt-2"},r.a.createElement(p.i,{xs:"12"},this.state.published&&r.a.createElement(p.c,{className:"float-right",size:"sm",color:"danger",onClick:function(){e.props.onUnpublish()}},"\u53d6\u6d88\u767c\u4f48"),r.a.createElement(p.c,{className:"float-right mr-2",size:"sm",color:"primary",onClick:this.handleSave},"\u5132\u5b58\u4e26\u767c\u4f48"))))),r.a.createElement("hr",null),r.a.createElement("h5",null,"\u904e\u6ffe\u63db\u8ab2\u8cc7\u8a0a"),r.a.createElement(p.C,null,r.a.createElement(p.i,{xs:"9"},r.a.createElement(pe.a,{className:"form-control",id:"Filter__input",onlyUnique:!0,value:this.state.filterTags,onChange:this.handleChangeFilter})),r.a.createElement(p.i,{className:"text-center",xs:"3"},r.a.createElement(p.c,{size:"sm",outline:!0,color:"primary",style:{verticalAlign:"sub"},onClick:function(){return e.handleFilter(!1)}},r.a.createElement("i",{className:"fa fa-filter","aria-hidden":"true"})," ",r.a.createElement("span",{className:"hidden-sm-down"},"\u904e\u6ffe"))," ",r.a.createElement(p.c,{size:"sm",outline:!0,color:"secondary",style:{verticalAlign:"sub"},onClick:function(){return e.handleFilter(!0)}},r.a.createElement("i",{className:"fa fa-refresh","aria-hidden":"true"})," ",r.a.createElement("span",{className:"hidden-sm-down"},"\u6e05\u9664")))),r.a.createElement(p.C,{className:"mt-2"},r.a.createElement(p.i,{className:"text-center",xs:"12"},r.a.createElement(ve,{onClick:this.handleToggleSetting},r.a.createElement("i",{className:"fa fa-bars","aria-hidden":"true"})))))))}}]),n}(r.a.Component);function Ce(){var e=Object(h.a)(["\n  font-size: 14px;\n"]);return Ce=function(){return e},e}function ke(){var e=Object(h.a)(["\n  border-bottom: 1px solid #787878;\n"]);return ke=function(){return e},e}function Oe(){var e=Object(h.a)(["\n  font-size: 14px;\n  color: #666;\n  border-left: 3px solid #bbb;\n"]);return Oe=function(){return e},e}function ye(){var e=Object(h.a)(["\n  font-size: 13px;\n  color: #989898;\n"]);return ye=function(){return e},e}function xe(){var e=Object(h.a)(["\n  color: #365899;\n  font-weight: bold;\n"]);return xe=function(){return e},e}function we(){var e=Object(h.a)(["\n  border-radius: 50px;\n"]);return we=function(){return e},e}function je(){var e=Object(h.a)(["\n  padding: 5px 5px 5px 30px;\n"]);return je=function(){return e},e}Ee.contextTypes={user:b.a.object};var Te=Object(g.b)(p.f)(je()),_e=g.b.img(we()),Ne=g.b.a(xe()),Se=g.b.td(ye()),Le=g.b.div(Oe()),Me=g.b.h6(ke()),De=g.b.div(Ce()),Re=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"render",value:function(){var e=this.props.item,t=e.fbLink,n=e.fbPicture,a=e.name,i=e.time,l=e.desc,o=e.have,c=e.want;return r.a.createElement(Te,null,r.a.createElement(p.C,null,r.a.createElement(p.i,{className:"mt-1",lg:"5",sm:"12",xs:"12"},r.a.createElement("div",null,r.a.createElement("table",null,r.a.createElement("tbody",null,r.a.createElement("tr",null,r.a.createElement("td",{className:"pr-1",rowSpan:"2"},r.a.createElement("a",Object.assign({href:t,target:"_blank",rel:"noopener noreferrer"},t?{}:{onClick:function(e){return e.preventDefault()}}),r.a.createElement(_e,{height:"45px",src:n||"https://graph.facebook.com/100/picture",alt:""}))),r.a.createElement("td",null,r.a.createElement(Ne,Object.assign({href:t,target:"_blank",rel:"noopener noreferrer"},t?{}:{onClick:function(e){return e.preventDefault()}}),a))),r.a.createElement("tr",null,r.a.createElement(Se,null,me()(i).utcOffset(8).format("YYYY/MM/DD HH:mm:ss")))))),r.a.createElement(Le,{className:"mt-1 ml-2 pl-1"},l.split("\n").map((function(e,t){return r.a.createElement("div",{key:t},e)})))),r.a.createElement(p.i,{lg:"4",sm:"12",xs:"12"},r.a.createElement(Me,{className:"pl-3"},"\u60f3\u8981\u7684\u8ab2"),c.map((function(e,t){return r.a.createElement(De,{key:t},r.a.createElement(p.b,{color:"secondary",pill:!0},t+1)," ",e)}))),r.a.createElement(p.i,{lg:"3",sm:"12",xs:"12"},r.a.createElement(Me,{className:"pl-3"},"\u4e0d\u9700\u8981\u7684\u8ab2"),o.map((function(e,t){return r.a.createElement(De,{key:t},r.a.createElement(p.b,{color:"secondary",pill:!0},t+1)," ",e)})))))}}]),n}(r.a.PureComponent),Fe=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"render",value:function(){return r.a.createElement(p.k,{className:"mb-5",style:{marginTop:"190px",transition:"all .5s"}},this.props.exchangeList.map((function(e,t){return r.a.createElement(p.C,{key:t,className:"mb-2"},r.a.createElement(p.i,{xs:"12"},r.a.createElement(Re,{item:e})))})))}}]),n}(r.a.Component),Be=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(c.a)(this,n),(a=t.call(this,e)).state={exchangeList:{},filter:null},a.db=window.firebase.database(),a.handleSaveExchangeSetting=a.handleSaveExchangeSetting.bind(Object(C.a)(a)),a.handleUnpublish=a.handleUnpublish.bind(Object(C.a)(a)),a.handleFilter=a.handleFilter.bind(Object(C.a)(a)),a.parseList=a.parseList.bind(Object(C.a)(a)),a}return Object(s.a)(n,[{key:"componentDidMount",value:function(){this.getExchangeList()}},{key:"getExchangeList",value:function(){var e=this;this.db.ref("exchangeList/").once("value").then((function(t){var n=t.val()||{};e.setState({exchangeList:n})}))}},{key:"handleSaveExchangeSetting",value:function(e,t,n){var a=this,r=this.context.user,i=r.displayName,l=r.uid,o=r.fbLink,c=void 0===o?null:o,s=r.fbPicture,u=void 0===s?"":s,d=r.uuid,m=me()().format();this.db.ref("exchangeList/".concat(d)).set(JSON.stringify({fbid:l,fbLink:c,fbPicture:u,name:i,want:t,have:e,desc:n,time:m})).then((function(){a.getExchangeList()}))}},{key:"handleUnpublish",value:function(){var e=this;this.db.ref("exchangeList/".concat(this.context.user.uuid)).remove().then((function(){e.getExchangeList()}))}},{key:"handleFilter",value:function(e){this.setState({filter:e})}},{key:"parseList",value:function(){var e=F()(this.state.exchangeList),t=this.state.filter?F()(this.state.filter):null,n=Object.values(e).map((function(e){return JSON.parse(e)}));return n=this.shuffle(n),t&&(n=n.filter((function(e){var n=!1,a=e.have.join("")+e.want.join("");return t.forEach((function(e){a.includes(e)&&(n=!0)})),n}))),n}},{key:"shuffle",value:function(e){for(var t,n,a=e.length;0!==a;)n=Math.floor(Math.random()*a),t=e[a-=1],e[a]=e[n],e[n]=t;return e}},{key:"render",value:function(){var e=this.parseList();return r.a.createElement("div",null,this.context.user&&!this.context.user.uid&&r.a.createElement(p.C,null,r.a.createElement(p.i,{xs:"12"},r.a.createElement(p.a,{className:"text-center mt-3",color:"danger"},"\u8acb\u5148\u767b\u5165"))),this.context.user&&this.context.user.uid&&r.a.createElement("div",null,r.a.createElement(Ee,{exchangeList:this.state.exchangeList,onSave:this.handleSaveExchangeSetting,onUnpublish:this.handleUnpublish,onToggleSetting:this.handleToggleSetting,onFilter:this.handleFilter}),r.a.createElement(p.k,{style:{height:"calc(100vh - 52px)",overflow:"auto",background:"#fff"}},!e.length&&r.a.createElement(I,{marginTop:450}),r.a.createElement(p.C,null,r.a.createElement(p.i,{xs:"12"},r.a.createElement(Fe,{exchangeList:e}))))))}}]),n}(r.a.Component);Be.contextTypes={user:b.a.object};var Ae=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"render",value:function(){return r.a.createElement(M,this.props,r.a.createElement(Be,null))}}]),n}(r.a.Component);function ze(){var e=Object(h.a)(["\n  background: #fff;\n  padding: 20px 5px;\n  box-shadow: 0 0 10px 0 #080808;\n  margin-top: 55px;\n  margin-bottom: 55px;\n"]);return ze=function(){return e},e}var Ie=g.b.div(ze()),Ue=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(c.a)(this,n),(a=t.call(this,e)).state={customTable:"Loading..."},a.db=window.firebase.database(),a}return Object(s.a)(n,[{key:"componentDidMount",value:function(){var e=this,t=this.context.router.route.match.params.hash,n=t.substring(0,t.length-4),a=t.substring(t.length-4,t.length);this.db.ref("sharedTable/".concat(n)).once("value").then((function(t){var n=t.val();if(null!==n){var r=JSON.parse(n)[a];r?e.setState({customTable:r}):e.setState({customTable:"\u9023\u7d50\u7121\u6548"})}else e.setState({customTable:"\u9023\u7d50\u7121\u6548"})}))}},{key:"render",value:function(){return r.a.createElement(M,null,r.a.createElement(Ie,null,r.a.createElement(p.C,null,r.a.createElement(p.i,{xs:"12"},"string"===typeof this.state.customTable&&r.a.createElement(p.a,{className:"text-center",color:"warning"},this.state.customTable),"string"!==typeof this.state.customTable&&r.a.createElement(oe,{tableData:this.state.customTable,shared:!0})))))}}]),n}(r.a.Component);Ue.contextTypes={router:b.a.object};var Pe=n(38),qe=(n(106),function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"mt-2"},r.a.createElement("h5",null,"\u641c\u5c0b\u8ab2\u7a0b"),r.a.createElement(pe.a,{className:"form-control",id:"ExchangeSetting__inputWant",value:this.props.filterTags,onChange:this.props.onFilter,onlyUnique:!0}),r.a.createElement("div",{className:"mt-2"},r.a.createElement(p.e,{size:"sm"},r.a.createElement(p.c,{className:1===this.props.sortType?"active":"",onClick:function(){return e.props.onChangeSortType(1)}},"\u6642\u9593\u512a\u5148")," ",r.a.createElement(p.c,{className:2===this.props.sortType?"active":"",onClick:function(){return e.props.onChangeSortType(2)}},"\u8a55\u50f9\u512a\u5148"))))}}]),n}(r.a.Component));n(107);function We(){var e=Object(h.a)(["\n      color: #d9534f;\n      font-weight: bold;\n    "]);return We=function(){return e},e}function Je(){var e=Object(h.a)(["\n  flex: 1;\n  padding: 7px;\n  transition: all 0.3s;\n  ","\n\n  &:hover {\n    background: #d9534f;\n    color: #fff;\n    cursor: pointer;\n  }\n"]);return Je=function(){return e},e}function He(){var e=Object(h.a)(["\n      color: #0275d8;\n      font-weight: bold;\n    "]);return He=function(){return e},e}function Ye(){var e=Object(h.a)(["\n  flex: 1;\n  padding: 7px;\n  transition: all 0.3s;\n  ","\n\n  &:hover {\n    background: #0275d8;\n    color: #fff;\n    cursor: pointer;\n  }\n"]);return Ye=function(){return e},e}function Ke(){var e=Object(h.a)(["\n  white-space: pre-line;\n"]);return Ke=function(){return e},e}function Ge(){var e=Object(h.a)(["\n  font-weight: bold;\n"]);return Ge=function(){return e},e}function Ve(){var e=Object(h.a)(["\n  font-size: 12px;\n  color: #90949c;\n"]);return Ve=function(){return e},e}function Ze(){var e=Object(h.a)(["\n  color: #365899;\n  font-size: 14px;\n  font-weight: bold;\n"]);return Ze=function(){return e},e}function $e(){var e=Object(h.a)(["\n  border-radius: 30px;\n"]);return $e=function(){return e},e}function Xe(){var e=Object(h.a)(["\n  position: absolute;\n  right: 15px;\n  font-size: 26px;\n  top: 12px;\n  cursor: pointer;\n  height: 17px;\n  line-height: 17px;\n  color: #d9534f;\n  &:hover {\n    color: #c9302c;\n  }\n"]);return Xe=function(){return e},e}function Qe(){var e=Object(h.a)(["\n  border-radius: 0;\n  box-shadow: 0 0 5px 0px #dddddd;\n"]);return Qe=function(){return e},e}var et=Object(g.b)(p.f)(Qe());et.DelBtn=g.b.span(Xe()),et.UserImg=g.b.img($e()),et.Username=g.b.span(Ze()),et.Date=g.b.span(Ve()),et.Title=g.b.div(Ge()),et.Content=g.b.div(Ke()),et.LikeBtn=g.b.span(Ye(),(function(e){return e.like&&Object(g.a)(He())})),et.DisLikeBtn=g.b.span(Je(),(function(e){return e.dislike&&Object(g.a)(We())}));var tt=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"render",value:function(){var e=this,t=this.props.data,n=1===+t.currentUserLike,a=-1===+t.currentUserLike;return r.a.createElement(et,{className:"mb-2"},r.a.createElement(p.g,{className:"pb-2"},r.a.createElement("div",{className:"mb-2"},r.a.createElement("table",null,r.a.createElement("tbody",null,r.a.createElement("tr",null,r.a.createElement("td",{className:"pr-2",rowSpan:"2"},r.a.createElement("a",Object.assign({href:t.fbLink,target:"_blank",rel:"noopener noreferrer"},t.fbLink?{}:{onClick:function(e){return e.preventDefault()}}),r.a.createElement(et.UserImg,{src:t.fbPicture||"https://graph.facebook.com/100/picture",height:"55",alt:""}))),r.a.createElement("td",null,r.a.createElement("a",Object.assign({href:t.fbLink,target:"_blank",rel:"noopener noreferrer"},t.fbLink?{}:{onClick:function(e){return e.preventDefault()}}),r.a.createElement(et.Username,null,t.username)),!!t.currentUserPost&&r.a.createElement(et.DelBtn,{onClick:function(){e.props.onDel(t.key)}},"\xd7"))),r.a.createElement("tr",null,r.a.createElement("td",null,r.a.createElement(et.Date,null,me()(t.time).utcOffset(8).format("YYYY/MM/DD HH:mm:ss"))))))),r.a.createElement("div",null,r.a.createElement(et.Title,null,t.cid?"".concat(t.cid," "):"",t.cname,t.teacher?" | ".concat(t.teacher):""),r.a.createElement(et.Content,null,t.content)),r.a.createElement("hr",{style:{marginBottom:"5px"}}),r.a.createElement("div",{style:{display:"flex"}},r.a.createElement(et.LikeBtn,{className:"text-center",like:!!n,onClick:function(){e.props.onLike(1,t.currentUserLike,t.key)}},r.a.createElement("i",{className:"fa ".concat(n?"fa-thumbs-up":"fa-thumbs-o-up"),"aria-hidden":"true"})," ",t.like[1]||0),r.a.createElement(et.DisLikeBtn,{className:"text-center",dislike:!!a,onClick:function(){e.props.onLike(-1,t.currentUserLike,t.key)}},r.a.createElement("i",{className:"fa ".concat(a?"fa-thumbs-down":"fa-thumbs-o-down"),"aria-hidden":"true"})," ",t.like[-1]||0))))}}]),n}(r.a.Component),nt=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"componentWillReceiveProps",value:function(){window.reviewListBricks&&window.reviewListBricks.destroy()}},{key:"componentDidUpdate",value:function(){window.reviewListBricks=new window.Bricklayer(document.querySelector(".bricklayer"))}},{key:"render",value:function(){var e=this;return r.a.createElement(p.h,{className:"mb-3 bricklayer"},this.props.reviewList.map((function(t,n){return r.a.createElement(tt,Object.assign({key:n,data:t},e.props))})))}}]),n}(r.a.Component);function at(){var e=Object(h.a)(["\n  overflow: auto;\n  height: calc(100vh - 202px);\n"]);return at=function(){return e},e}function rt(){var e=Object(h.a)(["\n  background: #db4437;\n  color: #fff;\n  padding: 10px 15px 0px 15px;\n  position: absolute;\n  right: 10px;\n  bottom: 10px;\n  width: 52px;\n  height: 52px;\n  border-radius: 30px;\n  overflow: hidden;\n  cursor: pointer;\n  box-shadow: 1px 1px 5px 1px #bbbbbb;\n  transition: all 0.3s;\n  &:hover {\n    width: 180px;\n    box-shadow: 1px 1px 5px 1px #787878;\n  }\n\n  i.fa {\n    padding-bottom: 15px;\n    font-size: 30px;\n    margin-right: 10px;\n  }\n"]);return rt=function(){return e},e}function it(){var e=Object(h.a)(["\n  background: #fff;\n  position: relative;\n"]);return it=function(){return e},e}var lt=Object(g.b)(p.k)(it()),ot=g.b.div(rt()),ct=Object(g.b)(p.C)(at()),st=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(c.a)(this,n),(a=t.call(this,e)).state={addReviewModalOpen:!1,reviewData:{},likeData:{},sortType:1,filterTags:[]},a.db=window.firebase.database(),a.toggleAddReviewModal=a.toggleAddReviewModal.bind(Object(C.a)(a)),a.handleAddReview=a.handleAddReview.bind(Object(C.a)(a)),a.getReviewList=a.getReviewList.bind(Object(C.a)(a)),a.parseReviewList=a.parseReviewList.bind(Object(C.a)(a)),a.handleFilter=a.handleFilter.bind(Object(C.a)(a)),a.handleChangeSortType=a.handleChangeSortType.bind(Object(C.a)(a)),a.handleDelReview=a.handleDelReview.bind(Object(C.a)(a)),a.handleLike=a.handleLike.bind(Object(C.a)(a)),a.getReviewList(),a}return Object(s.a)(n,[{key:"getReviewList",value:function(){var e,t,n=this;this.db.ref("review").once("value").then((function(t){e=t.val()||{}})).then((function(){n.db.ref("likedReview").once("value").then((function(a){t=a.val()||{},n.setState({reviewData:e,likeData:t})}))}))}},{key:"parseReviewList",value:function(){var e=this,t=F()(this.state.reviewData),n=F()(this.state.likeData),a=this.context.user&&this.context.user.uuid,r=[],i={};for(var l in Object.values(n).forEach((function(e,t){Object.keys(e).forEach((function(t,n){i[t]||(i[t]={}),i[t][e[t]]||(i[t][e[t]]=0),i[t][e[t]]++}))})),t){var o=function(o){var c=JSON.parse(t[l][o]),s=!1;e.state.filterTags.length>0?e.state.filterTags.some((function(e,t){return e=e.toLowerCase(),!!(c.cid.toLowerCase().includes(e)||c.cname.toLowerCase().includes(e)||c.teacher.toLowerCase().includes(e)||c.content.toLowerCase().includes(e))&&(s=!0,!0)})):s=!0,a&&n[a]&&void 0!==n[a][o]&&(c.currentUserLike=n[a][o]),a&&l===a&&(c.currentUserPost=!0),s&&r.push(Object(Pe.a)(Object(Pe.a)({},c),{},{key:o,like:i[o]||{}}))};for(var c in t[l])o(c)}return 1===this.state.sortType?r.sort(this.compareByTime):r.sort(this.compareByLike),r}},{key:"compareByTime",value:function(e,t){return me()(e.time).isBefore(me()(t.time))?1:me()(e.time).isBefore(me()(t.time))?-1:0}},{key:"compareByLike",value:function(e,t){return(e.like[1]||0)<(t.like[1]||0)?1:(e.like[1]||0)>(t.like[1]||0)?-1:0}},{key:"toggleAddReviewModal",value:function(){this.setState((function(e){return{addReviewModalOpen:!e.addReviewModalOpen}}))}},{key:"handleAddReview",value:function(){var e=this,t=document.getElementById("ModalAddReview__inputCname").value,n=document.getElementById("ModalAddReview__inputCid").value,a=document.getElementById("ModalAddReview__inputTeacher").value,r=document.getElementById("ModalAddReview__inputContent").value;if(""!==t&&""!==r){var i=this.context.user,l=i.uuid,o=i.uid,c=i.fbLink,s=void 0===c?null:c,u=i.fbPicture,d=void 0===u?"":u,m=i.displayName,h=me()().format(),p=(Date.now().toString(32)+Math.random().toString(32)).replace(".","");this.db.ref("review/".concat(l,"/").concat(p)).set(JSON.stringify({cname:t,cid:n,teacher:a,content:r,fbid:o,fbLink:s,fbPicture:d,username:m,time:h})).then((function(){e.toggleAddReviewModal(),e.getReviewList()}))}else alert("\u8ab2\u7a0b\u540d\u7a31\u3001\u8a55\u8ad6\u4e0d\u5f97\u70ba\u7a7a")}},{key:"handleFilter",value:function(e){this.setState({filterTags:e})}},{key:"handleChangeSortType",value:function(e){this.setState({sortType:e})}},{key:"handleDelReview",value:function(e){var t=this;window.confirm("\u78ba\u5b9a\u522a\u9664\u6b64\u7bc7\u8a55\u8ad6\uff1f")&&this.db.ref("review/".concat(this.context.user.uuid,"/").concat(e)).remove().then((function(){t.getReviewList()}))}},{key:"handleLike",value:function(e,t,n){var a=this;e===t?this.db.ref("likedReview/".concat(this.context.user.uuid,"/").concat(n)).remove().then((function(){a.getReviewList()})):this.db.ref("likedReview/".concat(this.context.user.uuid,"/").concat(n)).set(e).then((function(){a.getReviewList()}))}},{key:"render",value:function(){var e=this.parseReviewList();return r.a.createElement("div",null,this.context.user&&!this.context.user.uid&&r.a.createElement(p.C,null,r.a.createElement(p.i,{xs:"12"},r.a.createElement(p.a,{className:"text-center mt-3",color:"danger"},"\u8acb\u5148\u767b\u5165"))),this.context.user&&this.context.user.uid&&r.a.createElement(lt,null,r.a.createElement(p.C,{id:"CourseReviewFilter__wrapper"},r.a.createElement(p.i,{xs:"12"},r.a.createElement(qe,{filterTags:this.state.filterTags,onFilter:this.handleFilter,sortType:this.state.sortType,onChangeSortType:this.handleChangeSortType}))),r.a.createElement("hr",null),r.a.createElement(ct,null,r.a.createElement(p.i,{xs:"12"},r.a.createElement(nt,{reviewList:e,onDel:this.handleDelReview,onLike:this.handleLike}))),r.a.createElement(ot,{onClick:this.toggleAddReviewModal},r.a.createElement("i",{className:"fa fa-pencil","aria-hidden":"true"}),"\u7559\u4e0b\u4e00\u5247\u8a55\u8ad6..."),r.a.createElement(p.s,{size:"lg",isOpen:this.state.addReviewModalOpen,toggle:this.toggleAddReviewModal},r.a.createElement(p.v,{toggle:this.toggleAddReviewModal},"\u7559\u4e0b\u4e00\u5247\u8a55\u8ad6"),r.a.createElement(p.t,null,r.a.createElement(p.p,{row:!0},r.a.createElement(p.r,{className:"text-danger",for:"ModalAddReview__inputCname",sm:2},"\u8ab2\u7a0b\u540d\u7a31*"),r.a.createElement(p.i,{sm:10},r.a.createElement(p.q,{type:"text",id:"ModalAddReview__inputCname"}))),r.a.createElement(p.p,{row:!0},r.a.createElement(p.r,{for:"ModalAddReview__inputCid",sm:2},"\u8ab2\u865f"),r.a.createElement(p.i,{sm:10},r.a.createElement(p.q,{type:"text",id:"ModalAddReview__inputCid"}))),r.a.createElement(p.p,{row:!0},r.a.createElement(p.r,{for:"ModalAddReview__inputTeacher",sm:2},"\u6559\u5e2b"),r.a.createElement(p.i,{sm:10},r.a.createElement(p.q,{type:"text",id:"ModalAddReview__inputTeacher"}))),r.a.createElement(p.p,{row:!0},r.a.createElement(p.r,{className:"text-danger",for:"ModalAddReview__inputContent",sm:2},"\u8a55\u8ad6*"),r.a.createElement(p.i,{sm:10},r.a.createElement(p.q,{type:"textarea",name:"text",rows:"5",id:"ModalAddReview__inputContent"})))),r.a.createElement(p.u,null,r.a.createElement(p.c,{color:"primary",block:!0,onClick:this.handleAddReview},"\u9001\u51fa")))))}}]),n}(r.a.Component);st.contextTypes={user:b.a.object};var ut=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"render",value:function(){return r.a.createElement(M,this.props,r.a.createElement(st,null))}}]),n}(r.a.Component),dt=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function mt(e){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var t=e.installing;t.onstatechange=function(){"installed"===t.state&&(navigator.serviceWorker.controller?console.log("New content is available; please refresh."):console.log("Content is cached for offline use."))}}})).catch((function(e){console.error("Error during service worker registration:",e)}))}window.firebase.initializeApp({apiKey:"AIzaSyDsof_DycXOzeXGVwix3nTgHGZwtseEzJ0",authDomain:"kebiau-7864f.firebaseapp.com",databaseURL:"https://kebiau-7864f.firebaseio.com",projectId:"kebiau-7864f",storageBucket:"kebiau-7864f.appspot.com",messagingSenderId:"223133259969"}),l.a.render(r.a.createElement(o.a,null,r.a.createElement(o.e,null,r.a.createElement(o.d,{exact:!0,path:"/",component:ue}),r.a.createElement(o.d,{path:"/exchange",component:Ae}),r.a.createElement(o.d,{exact:!0,path:"/share/:hash",component:Ue}),r.a.createElement(o.d,{path:"/review",component:ut}),r.a.createElement(o.c,{from:"*",to:"/"}))),document.getElementById("app")),function(){if("serviceWorker"in navigator){if(new URL("/KeBiau",window.location).origin!==window.location.origin)return;window.addEventListener("load",(function(){var e="".concat("/KeBiau","/service-worker.js");dt?function(e){fetch(e).then((function(t){404===t.status||-1===t.headers.get("content-type").indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):mt(e)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(e):mt(e)}))}}()},54:function(e,t,n){e.exports=n(108)},77:function(e,t,n){}},[[54,1,2]]]);
//# sourceMappingURL=main.5e7555d0.chunk.js.map